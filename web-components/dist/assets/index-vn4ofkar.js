var yn=Object.defineProperty;var bn=(s,e,t)=>e in s?yn(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var Rt=(s,e,t)=>bn(s,typeof e!="symbol"?e+"":e,t);import{r as P,a as wn,N as xn,R as Fe,b as _n,c as X,B as jn,d as kn,e as at,f as Sn}from"./react-vendor-DLjaX180.js";import{S as js,M as En,X as Tn,U as On,B as Nn,a as gt,b as vr,c as Cn,T as Pn,d as ks,R as An,D as yr,e as Rn,f as br,A as Ir,g as $n,C as Ss,F as Es,P as In,h as Dn,i as Un,j as Ln,k as Mn,l as ot,m as lt,n as Dr,o as $t,p as Ur,V as Lr,I as Mr,q as Fn,E as Bn}from"./icons-DU4U93yR.js";import{R as qn,A as Wn,C as Fr,X as Br,Y as qr,T as Wr,a as Hn,L as Vn,b as Kn}from"./charts-B87ngMRG.js";import{o as Gn,r as zn,a as Jn,b as Yn,e as It,s as Qn,u as Xn}from"./forms-BB1zTAqY.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();var Ts={exports:{}},xt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zn=P,ei=Symbol.for("react.element"),ti=Symbol.for("react.fragment"),ri=Object.prototype.hasOwnProperty,si=Zn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ni={key:!0,ref:!0,__self:!0,__source:!0};function Os(s,e,t){var r,n={},i=null,a=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)ri.call(e,r)&&!ni.hasOwnProperty(r)&&(n[r]=e[r]);if(s&&s.defaultProps)for(r in e=s.defaultProps,e)n[r]===void 0&&(n[r]=e[r]);return{$$typeof:ei,type:s,key:i,ref:a,props:n,_owner:si.current}}xt.Fragment=ti;xt.jsx=Os;xt.jsxs=Os;Ts.exports=xt;var o=Ts.exports,Xt={},Hr=wn;Xt.createRoot=Hr.createRoot,Xt.hydrateRoot=Hr.hydrateRoot;const ii=({collapsed:s,onToggle:e,feishuContext:t})=>{const r=[{name:"数据看板",href:"/dashboard",icon:Nn,description:"实时数据统计"},{name:"用户管理",href:"/users",icon:gt,description:"用户信息管理"},{name:"内容审核",href:"/moderation",icon:vr,description:"内容审核中心"}];return o.jsxs("div",{className:`fixed left-0 top-0 h-full bg-bg-primary border-r border-border-primary transition-all duration-300 z-50 ${s?"w-16":"w-64"}`,children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border-secondary",children:[!s&&o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"w-8 h-8 bg-accent-primary rounded-lg flex items-center justify-center",children:o.jsx(js,{className:"w-5 h-5 text-white"})}),o.jsxs("div",{children:[o.jsx("h1",{className:"text-lg font-bold text-text-primary",children:"星趣管理"}),o.jsx("p",{className:"text-xs text-text-tertiary",children:"后台管理系统"})]})]}),o.jsx("button",{onClick:()=>e(!s),className:"p-2 rounded-lg hover:bg-bg-hover transition-colors",children:s?o.jsx(En,{className:"w-5 h-5 text-text-secondary"}):o.jsx(Tn,{className:"w-5 h-5 text-text-secondary"})})]}),t&&!s&&o.jsx("div",{className:"p-4 border-b border-border-secondary",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"w-10 h-10 bg-accent-light rounded-full flex items-center justify-center",children:o.jsx(On,{className:"w-5 h-5 text-accent-primary"})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("p",{className:"text-sm font-medium text-text-primary truncate",children:t.userName}),o.jsxs("p",{className:"text-xs text-text-tertiary truncate",children:["飞书用户 • ",t.permissions.length||0," 权限"]})]})]})}),o.jsx("nav",{className:"flex-1 overflow-y-auto p-4",children:o.jsx("div",{className:"space-y-2",children:r.map(n=>o.jsxs(xn,{to:n.href,className:({isActive:i})=>`flex items-center space-x-3 p-3 rounded-lg transition-colors ${i?"bg-accent-primary text-white":"text-text-secondary hover:bg-bg-hover hover:text-text-primary"}`,children:[o.jsx(n.icon,{className:`w-5 h-5 flex-shrink-0 ${s?"mx-auto":""}`}),!s&&o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("p",{className:"text-sm font-medium",children:n.name}),o.jsx("p",{className:"text-xs opacity-75",children:n.description})]})]},n.name))})}),!s&&o.jsx("div",{className:"p-4 border-t border-border-secondary",children:o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-xs text-text-tertiary",children:"星趣App v1.0.0"}),o.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:"Powered by Supabase"})]})})]})};var Ns={exports:{}},Cs={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Be=P;function ai(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var oi=typeof Object.is=="function"?Object.is:ai,li=Be.useState,ci=Be.useEffect,di=Be.useLayoutEffect,ui=Be.useDebugValue;function hi(s,e){var t=e(),r=li({inst:{value:t,getSnapshot:e}}),n=r[0].inst,i=r[1];return di(function(){n.value=t,n.getSnapshot=e,Dt(n)&&i({inst:n})},[s,t,e]),ci(function(){return Dt(n)&&i({inst:n}),s(function(){Dt(n)&&i({inst:n})})},[s]),ui(t),t}function Dt(s){var e=s.getSnapshot;s=s.value;try{var t=e();return!oi(s,t)}catch{return!0}}function fi(s,e){return e()}var mi=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?fi:hi;Cs.useSyncExternalStore=Be.useSyncExternalStore!==void 0?Be.useSyncExternalStore:mi;Ns.exports=Cs;var gi=Ns.exports;const Ps=0,As=1,Rs=2,Vr=3;var Kr=Object.prototype.hasOwnProperty;function Zt(s,e){var t,r;if(s===e)return!0;if(s&&e&&(t=s.constructor)===e.constructor){if(t===Date)return s.getTime()===e.getTime();if(t===RegExp)return s.toString()===e.toString();if(t===Array){if((r=s.length)===e.length)for(;r--&&Zt(s[r],e[r]););return r===-1}if(!t||typeof s=="object"){r=0;for(t in s)if(Kr.call(s,t)&&++r&&!Kr.call(e,t)||!(t in e)||!Zt(s[t],e[t]))return!1;return Object.keys(e).length===r}}return s!==s&&e!==e}const de=new WeakMap,pe=()=>{},G=pe(),er=Object,A=s=>s===G,se=s=>typeof s=="function",ye=(s,e)=>({...s,...e}),$s=s=>se(s.then),Ut={},ct={},wr="undefined",et=typeof window!=wr,tr=typeof document!=wr,pi=et&&"Deno"in window,vi=()=>et&&typeof window.requestAnimationFrame!=wr,Is=(s,e)=>{const t=de.get(s);return[()=>!A(e)&&s.get(e)||Ut,r=>{if(!A(e)){const n=s.get(e);e in ct||(ct[e]=n),t[5](e,ye(n,r),n||Ut)}},t[6],()=>!A(e)&&e in ct?ct[e]:!A(e)&&s.get(e)||Ut]};let rr=!0;const yi=()=>rr,[sr,nr]=et&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[pe,pe],bi=()=>{const s=tr&&document.visibilityState;return A(s)||s!=="hidden"},wi=s=>(tr&&document.addEventListener("visibilitychange",s),sr("focus",s),()=>{tr&&document.removeEventListener("visibilitychange",s),nr("focus",s)}),xi=s=>{const e=()=>{rr=!0,s()},t=()=>{rr=!1};return sr("online",e),sr("offline",t),()=>{nr("online",e),nr("offline",t)}},_i={isOnline:yi,isVisible:bi},ji={initFocus:wi,initReconnect:xi},Gr=!Fe.useId,Xe=!et||pi,ki=s=>vi()?window.requestAnimationFrame(s):setTimeout(s,1),Lt=Xe?P.useEffect:P.useLayoutEffect,Mt=typeof navigator<"u"&&navigator.connection,zr=!Xe&&Mt&&(["slow-2g","2g"].includes(Mt.effectiveType)||Mt.saveData),dt=new WeakMap,Si=s=>er.prototype.toString.call(s),Ft=(s,e)=>s===`[object ${e}]`;let Ei=0;const ir=s=>{const e=typeof s,t=Si(s),r=Ft(t,"Date"),n=Ft(t,"RegExp"),i=Ft(t,"Object");let a,c;if(er(s)===s&&!r&&!n){if(a=dt.get(s),a)return a;if(a=++Ei+"~",dt.set(s,a),Array.isArray(s)){for(a="@",c=0;c<s.length;c++)a+=ir(s[c])+",";dt.set(s,a)}if(i){a="#";const l=er.keys(s).sort();for(;!A(c=l.pop());)A(s[c])||(a+=c+":"+ir(s[c])+",");dt.set(s,a)}}else a=r?s.toJSON():e=="symbol"?s.toString():e=="string"?JSON.stringify(s):""+s;return a},xr=s=>{if(se(s))try{s=s()}catch{s=""}const e=s;return s=typeof s=="string"?s:(Array.isArray(s)?s.length:s)?ir(s):"",[s,e]};let Ti=0;const ar=()=>++Ti;async function Ds(...s){const[e,t,r,n]=s,i=ye({populateCache:!0,throwOnError:!0},typeof n=="boolean"?{revalidate:n}:n||{});let a=i.populateCache;const c=i.rollbackOnError;let l=i.optimisticData;const u=f=>typeof c=="function"?c(f):c!==!1,d=i.throwOnError;if(se(t)){const f=t,m=[],g=e.keys();for(const b of g)!/^\$(inf|sub)\$/.test(b)&&f(e.get(b)._k)&&m.push(b);return Promise.all(m.map(h))}return h(t);async function h(f){const[m]=xr(f);if(!m)return;const[g,b]=Is(e,m),[w,v,T,y]=de.get(e),_=()=>{const R=w[m];return(se(i.revalidate)?i.revalidate(g().data,f):i.revalidate!==!1)&&(delete T[m],delete y[m],R&&R[0])?R[0](Rs).then(()=>g().data):g().data};if(s.length<3)return _();let j=r,p,k=!1;const O=ar();v[m]=[O,0];const B=!A(l),L=g(),N=L.data,x=L._c,S=A(x)?N:x;if(B&&(l=se(l)?l(S,N):l,b({data:l,_c:S})),se(j))try{j=j(S)}catch(R){p=R,k=!0}if(j&&$s(j))if(j=await j.catch(R=>{p=R,k=!0}),O!==v[m][0]){if(k)throw p;return j}else k&&B&&u(p)&&(a=!0,b({data:S,_c:G}));if(a&&!k)if(se(a)){const R=a(j,S);b({data:R,error:G,_c:G})}else b({data:j,error:G,_c:G});if(v[m][1]=ar(),Promise.resolve(_()).then(()=>{b({_c:G})}),k){if(d)throw p;return}return j}}const Jr=(s,e)=>{for(const t in s)s[t][0]&&s[t][0](e)},Oi=(s,e)=>{if(!de.has(s)){const t=ye(ji,e),r=Object.create(null),n=Ds.bind(G,s);let i=pe;const a=Object.create(null),c=(d,h)=>{const f=a[d]||[];return a[d]=f,f.push(h),()=>f.splice(f.indexOf(h),1)},l=(d,h,f)=>{s.set(d,h);const m=a[d];if(m)for(const g of m)g(h,f)},u=()=>{if(!de.has(s)&&(de.set(s,[r,Object.create(null),Object.create(null),Object.create(null),n,l,c]),!Xe)){const d=t.initFocus(setTimeout.bind(G,Jr.bind(G,r,Ps))),h=t.initReconnect(setTimeout.bind(G,Jr.bind(G,r,As)));i=()=>{d&&d(),h&&h(),de.delete(s)}}};return u(),[s,n,u,i]}return[s,de.get(s)[4]]},Ni=(s,e,t,r,n)=>{const i=t.errorRetryCount,a=n.retryCount,c=~~((Math.random()+.5)*(1<<(a<8?a:8)))*t.errorRetryInterval;!A(i)&&a>i||setTimeout(r,c,n)},Ci=Zt,[Us,Pi]=Oi(new Map),Ai=ye({onLoadingSlow:pe,onSuccess:pe,onError:pe,onErrorRetry:Ni,onDiscarded:pe,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:zr?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:zr?5e3:3e3,compare:Ci,isPaused:()=>!1,cache:Us,mutate:Pi,fallback:{}},_i),Ri=(s,e)=>{const t=ye(s,e);if(e){const{use:r,fallback:n}=s,{use:i,fallback:a}=e;r&&i&&(t.use=r.concat(i)),n&&a&&(t.fallback=ye(n,a))}return t},$i=P.createContext({}),Ii="$inf$",Ls=et&&window.__SWR_DEVTOOLS_USE__,Di=Ls?window.__SWR_DEVTOOLS_USE__:[],Ui=()=>{Ls&&(window.__SWR_DEVTOOLS_REACT__=Fe)},Li=s=>se(s[1])?[s[0],s[1],s[2]||{}]:[s[0],null,(s[1]===null?s[2]:s[1])||{}],Mi=()=>ye(Ai,P.useContext($i)),Fi=s=>(e,t,r)=>s(e,t&&((...i)=>{const[a]=xr(e),[,,,c]=de.get(Us);if(a.startsWith(Ii))return t(...i);const l=c[a];return A(l)?t(...i):(delete c[a],l)}),r),Bi=Di.concat(Fi),qi=s=>function(...t){const r=Mi(),[n,i,a]=Li(t),c=Ri(r,a);let l=s;const{use:u}=c,d=(u||[]).concat(Bi);for(let h=d.length;h--;)l=d[h](l);return l(n,i||c.fetcher||null,c)},Wi=(s,e,t)=>{const r=e[s]||(e[s]=[]);return r.push(t),()=>{const n=r.indexOf(t);n>=0&&(r[n]=r[r.length-1],r.pop())}};Ui();const Bt=Fe.use||(s=>{switch(s.status){case"pending":throw s;case"fulfilled":return s.value;case"rejected":throw s.reason;default:throw s.status="pending",s.then(e=>{s.status="fulfilled",s.value=e},e=>{s.status="rejected",s.reason=e}),s}}),qt={dedupe:!0},Hi=(s,e,t)=>{const{cache:r,compare:n,suspense:i,fallbackData:a,revalidateOnMount:c,revalidateIfStale:l,refreshInterval:u,refreshWhenHidden:d,refreshWhenOffline:h,keepPreviousData:f}=t,[m,g,b,w]=de.get(r),[v,T]=xr(s),y=P.useRef(!1),_=P.useRef(!1),j=P.useRef(v),p=P.useRef(e),k=P.useRef(t),O=()=>k.current,B=()=>O().isVisible()&&O().isOnline(),[L,N,x,S]=Is(r,v),R=P.useRef({}).current,re=A(a)?A(t.fallback)?G:t.fallback[v]:a,ue=(U,I)=>{for(const W in R){const M=W;if(M==="data"){if(!n(U[M],I[M])&&(!A(U[M])||!n(it,I[M])))return!1}else if(I[M]!==U[M])return!1}return!0},Tr=P.useMemo(()=>{const U=!v||!e?!1:A(c)?O().isPaused()||i?!1:l!==!1:c,I=K=>{const ie=ye(K);return delete ie._k,U?{isValidating:!0,isLoading:!0,...ie}:ie},W=L(),M=S(),Z=I(W),Ce=W===M?Z:I(M);let q=Z;return[()=>{const K=I(L());return ue(K,q)?(q.data=K.data,q.isLoading=K.isLoading,q.isValidating=K.isValidating,q.error=K.error,q):(q=K,K)},()=>Ce]},[r,v]),Oe=gi.useSyncExternalStore(P.useCallback(U=>x(v,(I,W)=>{ue(W,I)||U()}),[r,v]),Tr[0],Tr[1]),Or=!y.current,mn=m[v]&&m[v].length>0,Ne=Oe.data,we=A(Ne)?re&&$s(re)?Bt(re):re:Ne,nt=Oe.error,Ct=P.useRef(we),it=f?A(Ne)?A(Ct.current)?we:Ct.current:Ne:we,Nr=mn&&!A(nt)?!1:Or&&!A(c)?c:O().isPaused()?!1:i?A(we)?!1:l:A(we)||l,Cr=!!(v&&e&&Or&&Nr),gn=A(Oe.isValidating)?Cr:Oe.isValidating,pn=A(Oe.isLoading)?Cr:Oe.isLoading,Ve=P.useCallback(async U=>{const I=p.current;if(!v||!I||_.current||O().isPaused())return!1;let W,M,Z=!0;const Ce=U||{},q=!b[v]||!Ce.dedupe,K=()=>Gr?!_.current&&v===j.current&&y.current:v===j.current,ie={isValidating:!1,isLoading:!1},Ar=()=>{N(ie)},Rr=()=>{const Q=b[v];Q&&Q[1]===M&&delete b[v]},$r={isValidating:!0};A(L().data)&&($r.isLoading=!0);try{if(q&&(N($r),t.loadingTimeout&&A(L().data)&&setTimeout(()=>{Z&&K()&&O().onLoadingSlow(v,t)},t.loadingTimeout),b[v]=[I(T),ar()]),[W,M]=b[v],W=await W,q&&setTimeout(Rr,t.dedupingInterval),!b[v]||b[v][1]!==M)return q&&K()&&O().onDiscarded(v),!1;ie.error=G;const Q=g[v];if(!A(Q)&&(M<=Q[0]||M<=Q[1]||Q[1]===0))return Ar(),q&&K()&&O().onDiscarded(v),!1;const ae=L().data;ie.data=n(ae,W)?ae:W,q&&K()&&O().onSuccess(W,v,t)}catch(Q){Rr();const ae=O(),{shouldRetryOnError:Pt}=ae;ae.isPaused()||(ie.error=Q,q&&K()&&(ae.onError(Q,v,ae),(Pt===!0||se(Pt)&&Pt(Q))&&(!O().revalidateOnFocus||!O().revalidateOnReconnect||B())&&ae.onErrorRetry(Q,v,ae,vn=>{const At=m[v];At&&At[0]&&At[0](Vr,vn)},{retryCount:(Ce.retryCount||0)+1,dedupe:!0})))}return Z=!1,Ar(),!0},[v,r]),Pr=P.useCallback((...U)=>Ds(r,j.current,...U),[]);if(Lt(()=>{p.current=e,k.current=t,A(Ne)||(Ct.current=Ne)}),Lt(()=>{if(!v)return;const U=Ve.bind(G,qt);let I=0;O().revalidateOnFocus&&(I=Date.now()+O().focusThrottleInterval);const M=Wi(v,m,(Z,Ce={})=>{if(Z==Ps){const q=Date.now();O().revalidateOnFocus&&q>I&&B()&&(I=q+O().focusThrottleInterval,U())}else if(Z==As)O().revalidateOnReconnect&&B()&&U();else{if(Z==Rs)return Ve();if(Z==Vr)return Ve(Ce)}});return _.current=!1,j.current=v,y.current=!0,N({_k:T}),Nr&&(b[v]||(A(we)||Xe?U():ki(U))),()=>{_.current=!0,M()}},[v]),Lt(()=>{let U;function I(){const M=se(u)?u(L().data):u;M&&U!==-1&&(U=setTimeout(W,M))}function W(){!L().error&&(d||O().isVisible())&&(h||O().isOnline())?Ve(qt).then(I):I()}return I(),()=>{U&&(clearTimeout(U),U=-1)}},[u,d,h,v]),P.useDebugValue(it),i&&A(we)&&v){if(!Gr&&Xe)throw new Error("Fallback data is required when using Suspense in SSR.");p.current=e,k.current=t,_.current=!1;const U=w[v];if(!A(U)){const I=Pr(U);Bt(I)}if(A(nt)){const I=Ve(qt);A(it)||(I.status="fulfilled",I.value=!0),Bt(I)}else throw nt}return{mutate:Pr,get data(){return R.data=!0,it},get error(){return R.error=!0,nt},get isValidating(){return R.isValidating=!0,gn},get isLoading(){return R.isLoading=!0,pn}}},Me=qi(Hi),ut=({title:s,value:e,change:t,trend:r="neutral",suffix:n="",prefix:i="",icon:a,loading:c=!1,className:l,onClick:u})=>{const d={up:"text-status-success",down:"text-status-error",neutral:"text-text-tertiary"},h={up:ks,down:Pn,neutral:Cn}[r],f=g=>typeof g=="number"?g>=1e6?`${(g/1e6).toFixed(1)}M`:g>=1e3?`${(g/1e3).toFixed(1)}K`:g.toLocaleString():g.toString(),m=(...g)=>g.filter(Boolean).join(" ");return c?o.jsxs("div",{className:m("bg-bg-elevated border border-border-primary rounded-lg p-6 shadow-card","animate-pulse",l),children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("div",{className:"h-4 bg-bg-tertiary rounded w-24"}),a&&o.jsx("div",{className:"h-5 w-5 bg-bg-tertiary rounded"})]}),o.jsx("div",{className:"h-8 bg-bg-tertiary rounded w-16 mb-2"}),o.jsx("div",{className:"h-4 bg-bg-tertiary rounded w-20"})]}):o.jsxs("div",{className:m("bg-bg-elevated border border-border-primary rounded-lg p-6 shadow-card","transition-all duration-200","hover:shadow-hover hover:border-border-focus",u&&"cursor-pointer",l),onClick:u,children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h3",{className:"text-sm font-medium text-text-secondary",children:s}),a&&o.jsx("div",{className:"flex-shrink-0 text-text-tertiary",children:a})]}),o.jsx("div",{className:"mb-2",children:o.jsxs("span",{className:"text-3xl font-bold text-text-primary",children:[i,f(e),n]})}),t&&o.jsxs("div",{className:m("flex items-center text-sm",d[r]),children:[o.jsx(h,{className:"w-4 h-4 mr-1"}),o.jsx("span",{className:"font-medium",children:t}),o.jsx("span",{className:"ml-1 text-text-tertiary",children:"vs 昨日"})]})]})},Yr=({title:s,subtitle:e,children:t,loading:r=!1,error:n,className:i,onRefresh:a,onExport:c,onFullscreen:l,actions:u,height:d=300})=>{const[h,f]=P.useState(!1),m=async()=>{if(!(!a||h)){f(!0);try{await a()}finally{f(!1)}}},g=(...b)=>b.filter(Boolean).join(" ");return o.jsxs("div",{className:g("bg-bg-elevated border border-border-primary rounded-lg shadow-card","overflow-hidden",i),children:[o.jsx("div",{className:"px-6 py-4 border-b border-border-secondary",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("h3",{className:"text-lg font-semibold text-text-primary truncate",children:s}),e&&o.jsx("p",{className:"text-sm text-text-tertiary mt-1",children:e})]}),o.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[u,a&&o.jsx("button",{onClick:m,disabled:h,className:g("p-2 text-text-tertiary hover:text-text-primary hover:bg-bg-hover rounded-md","transition-colors duration-200",h?"animate-spin":""),title:"刷新数据",children:o.jsx(An,{className:"w-4 h-4"})}),c&&o.jsx("button",{onClick:c,className:"p-2 text-text-tertiary hover:text-text-primary hover:bg-bg-hover rounded-md transition-colors duration-200",title:"导出数据",children:o.jsx(yr,{className:"w-4 h-4"})}),l&&o.jsx("button",{onClick:l,className:"p-2 text-text-tertiary hover:text-text-primary hover:bg-bg-hover rounded-md transition-colors duration-200",title:"全屏查看",children:o.jsx(Rn,{className:"w-4 h-4"})}),o.jsx("button",{className:"p-2 text-text-tertiary hover:text-text-primary hover:bg-bg-hover rounded-md transition-colors duration-200",children:o.jsx(br,{className:"w-4 h-4"})})]})]})}),o.jsxs("div",{className:"relative",style:{height:typeof d=="number"?`${d}px`:d},children:[r?o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-accent-primary border-t-transparent"}),o.jsx("p",{className:"text-sm text-text-tertiary",children:"加载中..."})]})}):n?o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-12 h-12 mx-auto mb-4 text-status-error",children:o.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})})}),o.jsx("p",{className:"text-sm text-status-error font-medium mb-2",children:"数据加载失败"}),o.jsx("p",{className:"text-xs text-text-tertiary mb-4",children:n}),a&&o.jsx("button",{onClick:m,className:"text-sm text-accent-primary hover:text-accent-hover font-medium",children:"重新加载"})]})}):o.jsx("div",{className:"h-full w-full p-6",children:t}),h&&!r&&o.jsx("div",{className:"absolute inset-0 bg-bg-primary bg-opacity-50 flex items-center justify-center",children:o.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-accent-primary border-t-transparent"})})]})]})};function pt(s){"@babel/helpers - typeof";return pt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pt(s)}function Ee(s){if(s===null||s===!0||s===!1)return NaN;var e=Number(s);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function z(s,e){if(e.length<s)throw new TypeError(s+" argument"+(s>1?"s":"")+" required, but only "+e.length+" present")}function ne(s){z(1,arguments);var e=Object.prototype.toString.call(s);return s instanceof Date||pt(s)==="object"&&e==="[object Date]"?new Date(s.getTime()):typeof s=="number"||e==="[object Number]"?new Date(s):((typeof s=="string"||e==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function Vi(s,e){z(2,arguments);var t=ne(s).getTime(),r=Ee(e);return new Date(t+r)}var Ki={};function _t(){return Ki}function Gi(s){var e=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return e.setUTCFullYear(s.getFullYear()),s.getTime()-e.getTime()}function zi(s){return z(1,arguments),s instanceof Date||pt(s)==="object"&&Object.prototype.toString.call(s)==="[object Date]"}function Ji(s){if(z(1,arguments),!zi(s)&&typeof s!="number")return!1;var e=ne(s);return!isNaN(Number(e))}function Yi(s,e){z(2,arguments);var t=Ee(e);return Vi(s,-t)}var Qi=864e5;function Xi(s){z(1,arguments);var e=ne(s),t=e.getTime();e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0);var r=e.getTime(),n=t-r;return Math.floor(n/Qi)+1}function vt(s){z(1,arguments);var e=1,t=ne(s),r=t.getUTCDay(),n=(r<e?7:0)+r-e;return t.setUTCDate(t.getUTCDate()-n),t.setUTCHours(0,0,0,0),t}function Ms(s){z(1,arguments);var e=ne(s),t=e.getUTCFullYear(),r=new Date(0);r.setUTCFullYear(t+1,0,4),r.setUTCHours(0,0,0,0);var n=vt(r),i=new Date(0);i.setUTCFullYear(t,0,4),i.setUTCHours(0,0,0,0);var a=vt(i);return e.getTime()>=n.getTime()?t+1:e.getTime()>=a.getTime()?t:t-1}function Zi(s){z(1,arguments);var e=Ms(s),t=new Date(0);t.setUTCFullYear(e,0,4),t.setUTCHours(0,0,0,0);var r=vt(t);return r}var ea=6048e5;function ta(s){z(1,arguments);var e=ne(s),t=vt(e).getTime()-Zi(e).getTime();return Math.round(t/ea)+1}function yt(s,e){var t,r,n,i,a,c,l,u;z(1,arguments);var d=_t(),h=Ee((t=(r=(n=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(a=e.locale)===null||a===void 0||(c=a.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&n!==void 0?n:d.weekStartsOn)!==null&&r!==void 0?r:(l=d.locale)===null||l===void 0||(u=l.options)===null||u===void 0?void 0:u.weekStartsOn)!==null&&t!==void 0?t:0);if(!(h>=0&&h<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var f=ne(s),m=f.getUTCDay(),g=(m<h?7:0)+m-h;return f.setUTCDate(f.getUTCDate()-g),f.setUTCHours(0,0,0,0),f}function Fs(s,e){var t,r,n,i,a,c,l,u;z(1,arguments);var d=ne(s),h=d.getUTCFullYear(),f=_t(),m=Ee((t=(r=(n=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(a=e.locale)===null||a===void 0||(c=a.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&n!==void 0?n:f.firstWeekContainsDate)!==null&&r!==void 0?r:(l=f.locale)===null||l===void 0||(u=l.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&t!==void 0?t:1);if(!(m>=1&&m<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var g=new Date(0);g.setUTCFullYear(h+1,0,m),g.setUTCHours(0,0,0,0);var b=yt(g,e),w=new Date(0);w.setUTCFullYear(h,0,m),w.setUTCHours(0,0,0,0);var v=yt(w,e);return d.getTime()>=b.getTime()?h+1:d.getTime()>=v.getTime()?h:h-1}function ra(s,e){var t,r,n,i,a,c,l,u;z(1,arguments);var d=_t(),h=Ee((t=(r=(n=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(a=e.locale)===null||a===void 0||(c=a.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&n!==void 0?n:d.firstWeekContainsDate)!==null&&r!==void 0?r:(l=d.locale)===null||l===void 0||(u=l.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&t!==void 0?t:1),f=Fs(s,e),m=new Date(0);m.setUTCFullYear(f,0,h),m.setUTCHours(0,0,0,0);var g=yt(m,e);return g}var sa=6048e5;function na(s,e){z(1,arguments);var t=ne(s),r=yt(t,e).getTime()-ra(t,e).getTime();return Math.round(r/sa)+1}function $(s,e){for(var t=s<0?"-":"",r=Math.abs(s).toString();r.length<e;)r="0"+r;return t+r}var he={y:function(e,t){var r=e.getUTCFullYear(),n=r>0?r:1-r;return $(t==="yy"?n%100:n,t.length)},M:function(e,t){var r=e.getUTCMonth();return t==="M"?String(r+1):$(r+1,2)},d:function(e,t){return $(e.getUTCDate(),t.length)},a:function(e,t){var r=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h:function(e,t){return $(e.getUTCHours()%12||12,t.length)},H:function(e,t){return $(e.getUTCHours(),t.length)},m:function(e,t){return $(e.getUTCMinutes(),t.length)},s:function(e,t){return $(e.getUTCSeconds(),t.length)},S:function(e,t){var r=t.length,n=e.getUTCMilliseconds(),i=Math.floor(n*Math.pow(10,r-3));return $(i,t.length)}},Pe={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},ia={G:function(e,t,r){var n=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return r.era(n,{width:"abbreviated"});case"GGGGG":return r.era(n,{width:"narrow"});case"GGGG":default:return r.era(n,{width:"wide"})}},y:function(e,t,r){if(t==="yo"){var n=e.getUTCFullYear(),i=n>0?n:1-n;return r.ordinalNumber(i,{unit:"year"})}return he.y(e,t)},Y:function(e,t,r,n){var i=Fs(e,n),a=i>0?i:1-i;if(t==="YY"){var c=a%100;return $(c,2)}return t==="Yo"?r.ordinalNumber(a,{unit:"year"}):$(a,t.length)},R:function(e,t){var r=Ms(e);return $(r,t.length)},u:function(e,t){var r=e.getUTCFullYear();return $(r,t.length)},Q:function(e,t,r){var n=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(n);case"QQ":return $(n,2);case"Qo":return r.ordinalNumber(n,{unit:"quarter"});case"QQQ":return r.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(n,{width:"wide",context:"formatting"})}},q:function(e,t,r){var n=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(n);case"qq":return $(n,2);case"qo":return r.ordinalNumber(n,{unit:"quarter"});case"qqq":return r.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(n,{width:"wide",context:"standalone"})}},M:function(e,t,r){var n=e.getUTCMonth();switch(t){case"M":case"MM":return he.M(e,t);case"Mo":return r.ordinalNumber(n+1,{unit:"month"});case"MMM":return r.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(n,{width:"wide",context:"formatting"})}},L:function(e,t,r){var n=e.getUTCMonth();switch(t){case"L":return String(n+1);case"LL":return $(n+1,2);case"Lo":return r.ordinalNumber(n+1,{unit:"month"});case"LLL":return r.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(n,{width:"wide",context:"standalone"})}},w:function(e,t,r,n){var i=na(e,n);return t==="wo"?r.ordinalNumber(i,{unit:"week"}):$(i,t.length)},I:function(e,t,r){var n=ta(e);return t==="Io"?r.ordinalNumber(n,{unit:"week"}):$(n,t.length)},d:function(e,t,r){return t==="do"?r.ordinalNumber(e.getUTCDate(),{unit:"date"}):he.d(e,t)},D:function(e,t,r){var n=Xi(e);return t==="Do"?r.ordinalNumber(n,{unit:"dayOfYear"}):$(n,t.length)},E:function(e,t,r){var n=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return r.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(n,{width:"short",context:"formatting"});case"EEEE":default:return r.day(n,{width:"wide",context:"formatting"})}},e:function(e,t,r,n){var i=e.getUTCDay(),a=(i-n.weekStartsOn+8)%7||7;switch(t){case"e":return String(a);case"ee":return $(a,2);case"eo":return r.ordinalNumber(a,{unit:"day"});case"eee":return r.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(i,{width:"short",context:"formatting"});case"eeee":default:return r.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,r,n){var i=e.getUTCDay(),a=(i-n.weekStartsOn+8)%7||7;switch(t){case"c":return String(a);case"cc":return $(a,t.length);case"co":return r.ordinalNumber(a,{unit:"day"});case"ccc":return r.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(i,{width:"narrow",context:"standalone"});case"cccccc":return r.day(i,{width:"short",context:"standalone"});case"cccc":default:return r.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,r){var n=e.getUTCDay(),i=n===0?7:n;switch(t){case"i":return String(i);case"ii":return $(i,t.length);case"io":return r.ordinalNumber(i,{unit:"day"});case"iii":return r.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(n,{width:"short",context:"formatting"});case"iiii":default:return r.day(n,{width:"wide",context:"formatting"})}},a:function(e,t,r){var n=e.getUTCHours(),i=n/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(e,t,r){var n=e.getUTCHours(),i;switch(n===12?i=Pe.noon:n===0?i=Pe.midnight:i=n/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(e,t,r){var n=e.getUTCHours(),i;switch(n>=17?i=Pe.evening:n>=12?i=Pe.afternoon:n>=4?i=Pe.morning:i=Pe.night,t){case"B":case"BB":case"BBB":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(e,t,r){if(t==="ho"){var n=e.getUTCHours()%12;return n===0&&(n=12),r.ordinalNumber(n,{unit:"hour"})}return he.h(e,t)},H:function(e,t,r){return t==="Ho"?r.ordinalNumber(e.getUTCHours(),{unit:"hour"}):he.H(e,t)},K:function(e,t,r){var n=e.getUTCHours()%12;return t==="Ko"?r.ordinalNumber(n,{unit:"hour"}):$(n,t.length)},k:function(e,t,r){var n=e.getUTCHours();return n===0&&(n=24),t==="ko"?r.ordinalNumber(n,{unit:"hour"}):$(n,t.length)},m:function(e,t,r){return t==="mo"?r.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):he.m(e,t)},s:function(e,t,r){return t==="so"?r.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):he.s(e,t)},S:function(e,t){return he.S(e,t)},X:function(e,t,r,n){var i=n._originalDate||e,a=i.getTimezoneOffset();if(a===0)return"Z";switch(t){case"X":return Xr(a);case"XXXX":case"XX":return je(a);case"XXXXX":case"XXX":default:return je(a,":")}},x:function(e,t,r,n){var i=n._originalDate||e,a=i.getTimezoneOffset();switch(t){case"x":return Xr(a);case"xxxx":case"xx":return je(a);case"xxxxx":case"xxx":default:return je(a,":")}},O:function(e,t,r,n){var i=n._originalDate||e,a=i.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Qr(a,":");case"OOOO":default:return"GMT"+je(a,":")}},z:function(e,t,r,n){var i=n._originalDate||e,a=i.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Qr(a,":");case"zzzz":default:return"GMT"+je(a,":")}},t:function(e,t,r,n){var i=n._originalDate||e,a=Math.floor(i.getTime()/1e3);return $(a,t.length)},T:function(e,t,r,n){var i=n._originalDate||e,a=i.getTime();return $(a,t.length)}};function Qr(s,e){var t=s>0?"-":"+",r=Math.abs(s),n=Math.floor(r/60),i=r%60;if(i===0)return t+String(n);var a=e;return t+String(n)+a+$(i,2)}function Xr(s,e){if(s%60===0){var t=s>0?"-":"+";return t+$(Math.abs(s)/60,2)}return je(s,e)}function je(s,e){var t=e||"",r=s>0?"-":"+",n=Math.abs(s),i=$(Math.floor(n/60),2),a=$(n%60,2);return r+i+t+a}var Zr=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},Bs=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},aa=function(e,t){var r=e.match(/(P+)(p+)?/)||[],n=r[1],i=r[2];if(!i)return Zr(e,t);var a;switch(n){case"P":a=t.dateTime({width:"short"});break;case"PP":a=t.dateTime({width:"medium"});break;case"PPP":a=t.dateTime({width:"long"});break;case"PPPP":default:a=t.dateTime({width:"full"});break}return a.replace("{{date}}",Zr(n,t)).replace("{{time}}",Bs(i,t))},oa={p:Bs,P:aa},la=["D","DD"],ca=["YY","YYYY"];function da(s){return la.indexOf(s)!==-1}function ua(s){return ca.indexOf(s)!==-1}function es(s,e,t){if(s==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var ha={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},fa=function(e,t,r){var n,i=ha[e];return typeof i=="string"?n=i:t===1?n=i.one:n=i.other.replace("{{count}}",t.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+n:n+" ago":n};function Wt(s){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.width?String(e.width):s.defaultWidth,r=s.formats[t]||s.formats[s.defaultWidth];return r}}var ma={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},ga={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},pa={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},va={date:Wt({formats:ma,defaultWidth:"full"}),time:Wt({formats:ga,defaultWidth:"full"}),dateTime:Wt({formats:pa,defaultWidth:"full"})},ya={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},ba=function(e,t,r,n){return ya[e]};function Ke(s){return function(e,t){var r=t!=null&&t.context?String(t.context):"standalone",n;if(r==="formatting"&&s.formattingValues){var i=s.defaultFormattingWidth||s.defaultWidth,a=t!=null&&t.width?String(t.width):i;n=s.formattingValues[a]||s.formattingValues[i]}else{var c=s.defaultWidth,l=t!=null&&t.width?String(t.width):s.defaultWidth;n=s.values[l]||s.values[c]}var u=s.argumentCallback?s.argumentCallback(e):e;return n[u]}}var wa={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},xa={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},_a={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},ja={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},ka={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Sa={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Ea=function(e,t){var r=Number(e),n=r%100;if(n>20||n<10)switch(n%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},Ta={ordinalNumber:Ea,era:Ke({values:wa,defaultWidth:"wide"}),quarter:Ke({values:xa,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:Ke({values:_a,defaultWidth:"wide"}),day:Ke({values:ja,defaultWidth:"wide"}),dayPeriod:Ke({values:ka,defaultWidth:"wide",formattingValues:Sa,defaultFormattingWidth:"wide"})};function Ge(s){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=t.width,n=r&&s.matchPatterns[r]||s.matchPatterns[s.defaultMatchWidth],i=e.match(n);if(!i)return null;var a=i[0],c=r&&s.parsePatterns[r]||s.parsePatterns[s.defaultParseWidth],l=Array.isArray(c)?Na(c,function(h){return h.test(a)}):Oa(c,function(h){return h.test(a)}),u;u=s.valueCallback?s.valueCallback(l):l,u=t.valueCallback?t.valueCallback(u):u;var d=e.slice(a.length);return{value:u,rest:d}}}function Oa(s,e){for(var t in s)if(s.hasOwnProperty(t)&&e(s[t]))return t}function Na(s,e){for(var t=0;t<s.length;t++)if(e(s[t]))return t}function Ca(s){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=e.match(s.matchPattern);if(!r)return null;var n=r[0],i=e.match(s.parsePattern);if(!i)return null;var a=s.valueCallback?s.valueCallback(i[0]):i[0];a=t.valueCallback?t.valueCallback(a):a;var c=e.slice(n.length);return{value:a,rest:c}}}var Pa=/^(\d+)(th|st|nd|rd)?/i,Aa=/\d+/i,Ra={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},$a={any:[/^b/i,/^(a|c)/i]},Ia={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Da={any:[/1/i,/2/i,/3/i,/4/i]},Ua={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},La={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Ma={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Fa={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Ba={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},qa={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Wa={ordinalNumber:Ca({matchPattern:Pa,parsePattern:Aa,valueCallback:function(e){return parseInt(e,10)}}),era:Ge({matchPatterns:Ra,defaultMatchWidth:"wide",parsePatterns:$a,defaultParseWidth:"any"}),quarter:Ge({matchPatterns:Ia,defaultMatchWidth:"wide",parsePatterns:Da,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:Ge({matchPatterns:Ua,defaultMatchWidth:"wide",parsePatterns:La,defaultParseWidth:"any"}),day:Ge({matchPatterns:Ma,defaultMatchWidth:"wide",parsePatterns:Fa,defaultParseWidth:"any"}),dayPeriod:Ge({matchPatterns:Ba,defaultMatchWidth:"any",parsePatterns:qa,defaultParseWidth:"any"})},Ha={code:"en-US",formatDistance:fa,formatLong:va,formatRelative:ba,localize:Ta,match:Wa,options:{weekStartsOn:0,firstWeekContainsDate:1}},Va=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Ka=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Ga=/^'([^]*?)'?$/,za=/''/g,Ja=/[a-zA-Z]/;function ve(s,e,t){var r,n,i,a,c,l,u,d,h,f,m,g,b,w;z(2,arguments);var v=String(e),T=_t(),y=(r=(n=void 0)!==null&&n!==void 0?n:T.locale)!==null&&r!==void 0?r:Ha,_=Ee((i=(a=(c=(l=void 0)!==null&&l!==void 0?l:void 0)!==null&&c!==void 0?c:T.firstWeekContainsDate)!==null&&a!==void 0?a:(u=T.locale)===null||u===void 0||(d=u.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&i!==void 0?i:1);if(!(_>=1&&_<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var j=Ee((h=(f=(m=(g=void 0)!==null&&g!==void 0?g:void 0)!==null&&m!==void 0?m:T.weekStartsOn)!==null&&f!==void 0?f:(b=T.locale)===null||b===void 0||(w=b.options)===null||w===void 0?void 0:w.weekStartsOn)!==null&&h!==void 0?h:0);if(!(j>=0&&j<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!y.localize)throw new RangeError("locale must contain localize property");if(!y.formatLong)throw new RangeError("locale must contain formatLong property");var p=ne(s);if(!Ji(p))throw new RangeError("Invalid time value");var k=Gi(p),O=Yi(p,k),B={firstWeekContainsDate:_,weekStartsOn:j,locale:y,_originalDate:p},L=v.match(Ka).map(function(N){var x=N[0];if(x==="p"||x==="P"){var S=oa[x];return S(N,y.formatLong)}return N}).join("").match(Va).map(function(N){if(N==="''")return"'";var x=N[0];if(x==="'")return Ya(N);var S=ia[x];if(S)return ua(N)&&es(N,e,String(s)),da(N)&&es(N,e,String(s)),S(O,N,y.localize,B);if(x.match(Ja))throw new RangeError("Format string contains an unescaped latin alphabet character `"+x+"`");return N}).join("");return L}function Ya(s){var e=s.match(Ga);return e?e[1].replace(za,"'"):s}const Qa=({data:s,variant:e="area",showGrid:t=!0,animate:r=!0,height:n=300})=>{const i=d=>ve(new Date(d),"MM/dd"),a=d=>d>=1e6?`${(d/1e6).toFixed(1)}M`:d>=1e3?`${(d/1e3).toFixed(1)}K`:d.toString(),c=({active:d,payload:h,label:f})=>{if(d&&h&&h.length){const m=h[0].payload;return o.jsxs("div",{className:"bg-bg-elevated border border-border-primary rounded-lg shadow-modal p-3",children:[o.jsx("p",{className:"text-sm font-medium text-text-primary mb-1",children:ve(new Date(f),"yyyy年MM月dd日")}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:"#00B96B"}}),o.jsx("span",{className:"text-sm text-text-secondary",children:"用户数："}),o.jsx("span",{className:"text-sm font-semibold text-text-primary ml-1",children:h[0].value.toLocaleString()})]}),m.label&&o.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:m.label})]})}return null},l="userGrowthGradient",u={data:s,margin:{top:20,right:30,left:20,bottom:5}};return o.jsx(qn,{width:"100%",height:n,children:e==="area"?o.jsxs(Wn,{...u,children:[o.jsx("defs",{children:o.jsxs("linearGradient",{id:l,x1:"0",y1:"0",x2:"0",y2:"1",children:[o.jsx("stop",{offset:"5%",stopColor:"#00B96B",stopOpacity:.3}),o.jsx("stop",{offset:"95%",stopColor:"#00B96B",stopOpacity:0})]})}),t&&o.jsx(Fr,{strokeDasharray:"3 3",stroke:"#E5E6EB",strokeOpacity:.5}),o.jsx(Br,{dataKey:"timestamp",tickFormatter:i,axisLine:!1,tickLine:!1,tick:{fill:"#8F959E",fontSize:12,fontFamily:"Inter"},dy:10}),o.jsx(qr,{tickFormatter:a,axisLine:!1,tickLine:!1,tick:{fill:"#8F959E",fontSize:12,fontFamily:"Inter"},width:60}),o.jsx(Wr,{content:o.jsx(c,{})}),o.jsx(Hn,{type:"monotone",dataKey:"value",stroke:"#00B96B",strokeWidth:3,fill:`url(#${l})`,dot:!1,activeDot:{r:6,fill:"#00B96B",strokeWidth:2,stroke:"#ffffff"},animationDuration:r?1e3:0,animationEasing:"ease-out"})]}):o.jsxs(Vn,{...u,children:[t&&o.jsx(Fr,{strokeDasharray:"3 3",stroke:"#E5E6EB",strokeOpacity:.5}),o.jsx(Br,{dataKey:"timestamp",tickFormatter:i,axisLine:!1,tickLine:!1,tick:{fill:"#8F959E",fontSize:12,fontFamily:"Inter"}}),o.jsx(qr,{tickFormatter:a,axisLine:!1,tickLine:!1,tick:{fill:"#8F959E",fontSize:12,fontFamily:"Inter"},width:60}),o.jsx(Wr,{content:o.jsx(c,{})}),o.jsx(Kn,{type:"monotone",dataKey:"value",stroke:"#00B96B",strokeWidth:3,dot:!1,activeDot:{r:6,fill:"#00B96B",strokeWidth:2,stroke:"#ffffff"},animationDuration:r?1e3:0,animationEasing:"ease-out"})]})})},Xa="modulepreload",Za=function(s){return"/"+s},ts={},tt=function(e,t,r){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),c=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(t.map(l=>{if(l=Za(l),l in ts)return;ts[l]=!0;const u=l.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":Xa,u||(h.as="script"),h.crossOrigin="",h.href=l,c&&h.setAttribute("nonce",c),document.head.appendChild(h),u)return new Promise((f,m)=>{h.addEventListener("load",f),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(a){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a}return n.then(a=>{for(const c of a||[])c.status==="rejected"&&i(c.reason);return e().catch(i)})},eo=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>tt(async()=>{const{default:r}=await Promise.resolve().then(()=>We);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class _r extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class to extends _r{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class rs extends _r{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ss extends _r{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var or;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(or||(or={}));var ro=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function c(d){try{u(r.next(d))}catch(h){a(h)}}function l(d){try{u(r.throw(d))}catch(h){a(h)}}function u(d){d.done?i(d.value):n(d.value).then(c,l)}u((r=r.apply(s,e||[])).next())})};class so{constructor(e,{headers:t={},customFetch:r,region:n=or.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=eo(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return ro(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:a}=t;let c={},{region:l}=t;l||(l=this.region);const u=new URL(`${this.url}/${e}`);l&&l!=="any"&&(c["x-region"]=l,u.searchParams.set("forceFunctionRegion",l));let d;a&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",d=a):typeof a=="string"?(c["Content-Type"]="text/plain",d=a):typeof FormData<"u"&&a instanceof FormData?d=a:(c["Content-Type"]="application/json",d=JSON.stringify(a)));const h=yield this.fetch(u.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),n),body:d}).catch(b=>{throw new to(b)}),f=h.headers.get("x-relay-error");if(f&&f==="true")throw new rs(h);if(!h.ok)throw new ss(h);let m=((r=h.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),g;return m==="application/json"?g=yield h.json():m==="application/octet-stream"?g=yield h.blob():m==="text/event-stream"?g=h:m==="multipart/form-data"?g=yield h.formData():g=yield h.text(),{data:g,error:null,response:h}}catch(n){return{data:null,error:n,response:n instanceof ss||n instanceof rs?n.context:void 0}}})}}var Y={},jr={},jt={},rt={},kt={},St={},no=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},qe=no();const io=qe.fetch,qs=qe.fetch.bind(qe),Ws=qe.Headers,ao=qe.Request,oo=qe.Response,We=Object.freeze(Object.defineProperty({__proto__:null,Headers:Ws,Request:ao,Response:oo,default:qs,fetch:io},Symbol.toStringTag,{value:"Module"})),lo=_n(We);var Et={};Object.defineProperty(Et,"__esModule",{value:!0});let co=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Et.default=co;var Hs=X&&X.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(St,"__esModule",{value:!0});const uo=Hs(lo),ho=Hs(Et);let fo=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=uo.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let n=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var a,c,l;let u=null,d=null,h=null,f=i.status,m=i.statusText;if(i.ok){if(this.method!=="HEAD"){const v=await i.text();v===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?d=v:d=JSON.parse(v))}const b=(a=this.headers.Prefer)===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),w=(c=i.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");b&&w&&w.length>1&&(h=parseInt(w[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(d)&&(d.length>1?(u={code:"PGRST116",details:`Results contain ${d.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},d=null,h=null,f=406,m="Not Acceptable"):d.length===1?d=d[0]:d=null)}else{const b=await i.text();try{u=JSON.parse(b),Array.isArray(u)&&i.status===404&&(d=[],u=null,f=200,m="OK")}catch{i.status===404&&b===""?(f=204,m="No Content"):u={message:b}}if(u&&this.isMaybeSingle&&(!((l=u==null?void 0:u.details)===null||l===void 0)&&l.includes("0 rows"))&&(u=null,f=200,m="OK"),u&&this.shouldThrowOnError)throw new ho.default(u)}return{error:u,data:d,count:h,status:f,statusText:m}});return this.shouldThrowOnError||(n=n.catch(i=>{var a,c,l;return{error:{message:`${(a=i==null?void 0:i.name)!==null&&a!==void 0?a:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(c=i==null?void 0:i.stack)!==null&&c!==void 0?c:""}`,hint:"",code:`${(l=i==null?void 0:i.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}};St.default=fo;var mo=X&&X.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(kt,"__esModule",{value:!0});const go=mo(St);let po=class extends go.default{select(e){let t=!1;const r=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:n,referencedTable:i=n}={}){const a=i?`${i}.order`:"order",c=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${c?`${c},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const n=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:n=r}={}){const i=typeof n>"u"?"offset":`${n}.offset`,a=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(a,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:n=!1,wal:i=!1,format:a="text"}={}){var c;const l=[e?"analyze":null,t?"verbose":null,r?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),u=(c=this.headers.Accept)!==null&&c!==void 0?c:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${u}"; options=${l};`,a==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};kt.default=po;var vo=X&&X.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(rt,"__esModule",{value:!0});const yo=vo(kt);let bo=class extends yo.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");const a=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};rt.default=bo;var wo=X&&X.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(jt,"__esModule",{value:!0});const ze=wo(rt);let xo=class{constructor(e,{headers:t={},schema:r,fetch:n}){this.url=e,this.headers=t,this.schema=r,this.fetch=n}select(e,{head:t=!1,count:r}={}){const n=t?"HEAD":"GET";let i=!1;const a=(e??"*").split("").map(c=>/\s/.test(c)&&!i?"":(c==='"'&&(i=!i),c)).join("");return this.url.searchParams.set("select",a),r&&(this.headers.Prefer=`count=${r}`),new ze.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const n="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const a=e.reduce((c,l)=>c.concat(Object.keys(l)),[]);if(a.length>0){const c=[...new Set(a)].map(l=>`"${l}"`);this.url.searchParams.set("columns",c.join(","))}}return new ze.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:n,defaultToNull:i=!0}={}){const a="POST",c=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&c.push(this.headers.Prefer),n&&c.push(`count=${n}`),i||c.push("missing=default"),this.headers.Prefer=c.join(","),Array.isArray(e)){const l=e.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(l.length>0){const u=[...new Set(l)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new ze.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),this.headers.Prefer=n.join(","),new ze.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new ze.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};jt.default=xo;var Tt={},Ot={};Object.defineProperty(Ot,"__esModule",{value:!0});Ot.version=void 0;Ot.version="0.0.0-automated";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.DEFAULT_HEADERS=void 0;const _o=Ot;Tt.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${_o.version}`};var Vs=X&&X.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(jr,"__esModule",{value:!0});const jo=Vs(jt),ko=Vs(rt),So=Tt;let Eo=class Ks{constructor(e,{headers:t={},schema:r,fetch:n}={}){this.url=e,this.headers=Object.assign(Object.assign({},So.DEFAULT_HEADERS),t),this.schemaName=r,this.fetch=n}from(e){const t=new URL(`${this.url}/${e}`);return new jo.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Ks(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:n=!1,count:i}={}){let a;const c=new URL(`${this.url}/rpc/${e}`);let l;r||n?(a=r?"HEAD":"GET",Object.entries(t).filter(([d,h])=>h!==void 0).map(([d,h])=>[d,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([d,h])=>{c.searchParams.append(d,h)})):(a="POST",l=t);const u=Object.assign({},this.headers);return i&&(u.Prefer=`count=${i}`),new ko.default({method:a,url:c,headers:u,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};jr.default=Eo;var He=X&&X.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Y,"__esModule",{value:!0});Y.PostgrestError=Y.PostgrestBuilder=Y.PostgrestTransformBuilder=Y.PostgrestFilterBuilder=Y.PostgrestQueryBuilder=Y.PostgrestClient=void 0;const Gs=He(jr);Y.PostgrestClient=Gs.default;const zs=He(jt);Y.PostgrestQueryBuilder=zs.default;const Js=He(rt);Y.PostgrestFilterBuilder=Js.default;const Ys=He(kt);Y.PostgrestTransformBuilder=Ys.default;const Qs=He(St);Y.PostgrestBuilder=Qs.default;const Xs=He(Et);Y.PostgrestError=Xs.default;var To=Y.default={PostgrestClient:Gs.default,PostgrestQueryBuilder:zs.default,PostgrestFilterBuilder:Js.default,PostgrestTransformBuilder:Ys.default,PostgrestBuilder:Qs.default,PostgrestError:Xs.default};const{PostgrestClient:Oo,PostgrestQueryBuilder:Dc,PostgrestFilterBuilder:Uc,PostgrestTransformBuilder:Lc,PostgrestBuilder:Mc,PostgrestError:Fc}=To;function No(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const Co=No(),Po="2.11.15",Ao=`realtime-js/${Po}`,Ro="1.0.0",Zs=1e4,$o=1e3;var Ye;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(Ye||(Ye={}));var H;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(H||(H={}));var te;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(te||(te={}));var lr;(function(s){s.websocket="websocket"})(lr||(lr={}));var Se;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(Se||(Se={}));class Io{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const n=t.getUint8(1),i=t.getUint8(2);let a=this.HEADER_LENGTH+2;const c=r.decode(e.slice(a,a+n));a=a+n;const l=r.decode(e.slice(a,a+i));a=a+i;const u=JSON.parse(r.decode(e.slice(a,e.byteLength)));return{ref:null,topic:c,event:l,payload:u}}}class en{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var D;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(D||(D={}));const ns=(s,e,t={})=>{var r;const n=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,a)=>(i[a]=Do(a,s,e,n),i),{})},Do=(s,e,t,r)=>{const n=e.find(c=>c.name===s),i=n==null?void 0:n.type,a=t[s];return i&&!r.includes(i)?tn(i,a):cr(a)},tn=(s,e)=>{if(s.charAt(0)==="_"){const t=s.slice(1,s.length);return Fo(e,t)}switch(s){case D.bool:return Uo(e);case D.float4:case D.float8:case D.int2:case D.int4:case D.int8:case D.numeric:case D.oid:return Lo(e);case D.json:case D.jsonb:return Mo(e);case D.timestamp:return Bo(e);case D.abstime:case D.date:case D.daterange:case D.int4range:case D.int8range:case D.money:case D.reltime:case D.text:case D.time:case D.timestamptz:case D.timetz:case D.tsrange:case D.tstzrange:return cr(e);default:return cr(e)}},cr=s=>s,Uo=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},Lo=s=>{if(typeof s=="string"){const e=parseFloat(s);if(!Number.isNaN(e))return e}return s},Mo=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(e){return console.log(`JSON parse error: ${e}`),s}return s},Fo=(s,e)=>{if(typeof s!="string")return s;const t=s.length-1,r=s[t];if(s[0]==="{"&&r==="}"){let i;const a=s.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(c=>tn(e,c))}return s},Bo=s=>typeof s=="string"?s.replace(" ","T"):s,rn=s=>{let e=s;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Ht{constructor(e,t,r={},n=Zs){this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var is;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(is||(is={}));class Qe{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:i,onLeave:a,onSync:c}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Qe.syncState(this.state,n,i,a),this.pendingDiffs.forEach(l=>{this.state=Qe.syncDiff(this.state,l,i,a)}),this.pendingDiffs=[],c()}),this.channel._on(r.diff,{},n=>{const{onJoin:i,onLeave:a,onSync:c}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=Qe.syncDiff(this.state,n,i,a),c())}),this.onJoin((n,i,a)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:a})}),this.onLeave((n,i,a)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,n){const i=this.cloneDeep(e),a=this.transformState(t),c={},l={};return this.map(i,(u,d)=>{a[u]||(l[u]=d)}),this.map(a,(u,d)=>{const h=i[u];if(h){const f=d.map(w=>w.presence_ref),m=h.map(w=>w.presence_ref),g=d.filter(w=>m.indexOf(w.presence_ref)<0),b=h.filter(w=>f.indexOf(w.presence_ref)<0);g.length>0&&(c[u]=g),b.length>0&&(l[u]=b)}else c[u]=d}),this.syncDiff(i,{joins:c,leaves:l},r,n)}static syncDiff(e,t,r,n){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(i,(c,l)=>{var u;const d=(u=e[c])!==null&&u!==void 0?u:[];if(e[c]=this.cloneDeep(l),d.length>0){const h=e[c].map(m=>m.presence_ref),f=d.filter(m=>h.indexOf(m.presence_ref)<0);e[c].unshift(...f)}r(c,d,l)}),this.map(a,(c,l)=>{let u=e[c];if(!u)return;const d=l.map(h=>h.presence_ref);u=u.filter(h=>d.indexOf(h.presence_ref)<0),e[c]=u,n(c,u,l),u.length===0&&delete e[c]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const n=e[r];return"metas"in n?t[r]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var as;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(as||(as={}));var os;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(os||(os={}));var le;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(le||(le={}));class kr{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=H.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ht(this,te.join,this.params,this.timeout),this.rejoinTimer=new en(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=H.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=H.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=H.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=H.errored,this.rejoinTimer.scheduleTimeout())}),this._on(te.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new Qe(this),this.broadcastEndpointURL=rn(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,n;if(this.socket.isConnected()||this.socket.connect(),this.state==H.closed){const{config:{broadcast:i,presence:a,private:c}}=this.params;this._onError(d=>e==null?void 0:e(le.CHANNEL_ERROR,d)),this._onClose(()=>e==null?void 0:e(le.CLOSED));const l={},u={broadcast:i,presence:a,postgres_changes:(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(d=>d.filter))!==null&&n!==void 0?n:[],private:c};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:u},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:d})=>{var h;if(this.socket.setAuth(),d===void 0){e==null||e(le.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,m=(h=f==null?void 0:f.length)!==null&&h!==void 0?h:0,g=[];for(let b=0;b<m;b++){const w=f[b],{filter:{event:v,schema:T,table:y,filter:_}}=w,j=d&&d[b];if(j&&j.event===v&&j.schema===T&&j.table===y&&j.filter===_)g.push(Object.assign(Object.assign({},w),{id:j.id}));else{this.unsubscribe(),this.state=H.errored,e==null||e(le.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(le.SUBSCRIBED);return}}).receive("error",d=>{this.state=H.errored,e==null||e(le.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(d).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(le.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,n;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:a}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((n=u.body)===null||n===void 0?void 0:n.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,c,l;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(c=(a=this.params)===null||a===void 0?void 0:a.config)===null||c===void 0?void 0:c.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=H.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(te.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(n=>{r=new Ht(this,te.leave,{},e),r.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,r){const n=new AbortController,i=setTimeout(()=>n.abort(),r),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),a}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Ht(this,e,t,r);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,i;const a=e.toLocaleLowerCase(),{close:c,error:l,leave:u,join:d}=te;if(r&&[c,l,u,d].indexOf(a)>=0&&r!==this._joinRef())return;let f=this._onMessage(a,t,r);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(m=>{var g,b,w;return((g=m.filter)===null||g===void 0?void 0:g.event)==="*"||((w=(b=m.filter)===null||b===void 0?void 0:b.event)===null||w===void 0?void 0:w.toLocaleLowerCase())===a}).map(m=>m.callback(f,r)):(i=this.bindings[a])===null||i===void 0||i.filter(m=>{var g,b,w,v,T,y;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in m){const _=m.id,j=(g=m.filter)===null||g===void 0?void 0:g.event;return _&&((b=t.ids)===null||b===void 0?void 0:b.includes(_))&&(j==="*"||(j==null?void 0:j.toLocaleLowerCase())===((w=t.data)===null||w===void 0?void 0:w.type.toLocaleLowerCase()))}else{const _=(T=(v=m==null?void 0:m.filter)===null||v===void 0?void 0:v.event)===null||T===void 0?void 0:T.toLocaleLowerCase();return _==="*"||_===((y=t==null?void 0:t.event)===null||y===void 0?void 0:y.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===a}).map(m=>{if(typeof f=="object"&&"ids"in f){const g=f.data,{schema:b,table:w,commit_timestamp:v,type:T,errors:y}=g;f=Object.assign(Object.assign({},{schema:b,table:w,commit_timestamp:v,eventType:T,new:{},old:{},errors:y}),this._getPayloadRecords(g))}m.callback(f,r)})}_isClosed(){return this.state===H.closed}_isJoined(){return this.state===H.joined}_isJoining(){return this.state===H.joining}_isLeaving(){return this.state===H.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&kr.isEqual(n.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(te.close,{},e)}_onError(e){this._on(te.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=H.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=ns(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=ns(e.columns,e.old_record)),t}}const ls=()=>{},qo=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Wo{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Zs,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=ls,this.ref=0,this.logger=ls,this.conn=null,this.sendBuffer=[],this.serializer=new Io,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let a;return i?a=i:typeof fetch>"u"?a=(...c)=>tt(async()=>{const{default:l}=await Promise.resolve().then(()=>We);return{default:l}},void 0).then(({default:l})=>l(...c)):a=fetch,(...c)=>a(...c)},this.endPoint=`${e}/${lr.websocket}`,this.httpEndpoint=rn(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const n=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,a)=>a(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new en(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=Co),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Ro}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(r=>r.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Ye.connecting:return Se.Connecting;case Ye.open:return Se.Open;case Ye.closing:return Se.Closing;default:return Se.Closed}}isConnected(){return this.connectionState()===Se.Open}channel(e,t={config:{}}){const r=`realtime:${e}`,n=this.getChannels().find(i=>i.topic===r);if(n)return n;{const i=new kr(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:r,payload:n,ref:i}=e,a=()=>{this.encode(e,c=>{var l;(l=this.conn)===null||l===void 0||l.send(c)})};this.log("push",`${t} ${r} (${i})`,n),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const n={access_token:t,version:Ao};t&&r.updateJoinPayload(n),r.joinedOnce&&r._isJoined()&&r._push(te.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close($o,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:n,payload:i,ref:a}=t;r==="phoenix"&&n==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),a&&a===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${n} ${a&&"("+a+")"||""}`,i),Array.from(this.channels).filter(c=>c._isMember(r)).forEach(c=>c._trigger(n,i,a)),this.stateChangeCallbacks.message.forEach(c=>c(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(te.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${r}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([qo],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class Sr extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function F(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class Ho extends Sr{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class dr extends Sr{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Vo=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function c(d){try{u(r.next(d))}catch(h){a(h)}}function l(d){try{u(r.throw(d))}catch(h){a(h)}}function u(d){d.done?i(d.value):n(d.value).then(c,l)}u((r=r.apply(s,e||[])).next())})};const sn=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>tt(async()=>{const{default:r}=await Promise.resolve().then(()=>We);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Ko=()=>Vo(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield tt(()=>Promise.resolve().then(()=>We),void 0)).Response:Response}),ur=s=>{if(Array.isArray(s))return s.map(t=>ur(t));if(typeof s=="function"||s!==Object(s))return s;const e={};return Object.entries(s).forEach(([t,r])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=ur(r)}),e},Go=s=>{if(typeof s!="object"||s===null)return!1;const e=Object.getPrototypeOf(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)};var Te=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function c(d){try{u(r.next(d))}catch(h){a(h)}}function l(d){try{u(r.throw(d))}catch(h){a(h)}}function u(d){d.done?i(d.value):n(d.value).then(c,l)}u((r=r.apply(s,e||[])).next())})};const Vt=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),zo=(s,e,t)=>Te(void 0,void 0,void 0,function*(){const r=yield Ko();s instanceof r&&!(t!=null&&t.noResolveJson)?s.json().then(n=>{const i=s.status||500,a=(n==null?void 0:n.statusCode)||i+"";e(new Ho(Vt(n),i,a))}).catch(n=>{e(new dr(Vt(n),n))}):e(new dr(Vt(s),s))}),Jo=(s,e,t,r)=>{const n={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"||!r?n:(Go(r)?(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),n.body=JSON.stringify(r)):n.body=r,Object.assign(Object.assign({},n),t))};function st(s,e,t,r,n,i){return Te(this,void 0,void 0,function*(){return new Promise((a,c)=>{s(t,Jo(e,r,n,i)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>a(l)).catch(l=>zo(l,c,r))})})}function bt(s,e,t,r){return Te(this,void 0,void 0,function*(){return st(s,"GET",e,t,r)})}function ce(s,e,t,r,n){return Te(this,void 0,void 0,function*(){return st(s,"POST",e,r,n,t)})}function hr(s,e,t,r,n){return Te(this,void 0,void 0,function*(){return st(s,"PUT",e,r,n,t)})}function Yo(s,e,t,r){return Te(this,void 0,void 0,function*(){return st(s,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function nn(s,e,t,r,n){return Te(this,void 0,void 0,function*(){return st(s,"DELETE",e,r,n,t)})}var J=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function c(d){try{u(r.next(d))}catch(h){a(h)}}function l(d){try{u(r.throw(d))}catch(h){a(h)}}function u(d){d.done?i(d.value):n(d.value).then(c,l)}u((r=r.apply(s,e||[])).next())})};const Qo={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},cs={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Xo{constructor(e,t={},r,n){this.url=e,this.headers=t,this.bucketId=r,this.fetch=sn(n)}uploadOrUpdate(e,t,r,n){return J(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},cs),n);let c=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const l=a.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",a.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=r,c["cache-control"]=`max-age=${a.cacheControl}`,c["content-type"]=a.contentType,l&&(c["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),n!=null&&n.headers&&(c=Object.assign(Object.assign({},c),n.headers));const u=this._removeEmptyFolders(t),d=this._getFinalPath(u),h=yield(e=="PUT"?hr:ce)(this.fetch,`${this.url}/object/${d}`,i,Object.assign({headers:c},a!=null&&a.duplex?{duplex:a.duplex}:{}));return{data:{path:u,id:h.Id,fullPath:h.Key},error:null}}catch(i){if(F(i))return{data:null,error:i};throw i}})}upload(e,t,r){return J(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,n){return J(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),c=new URL(this.url+`/object/upload/sign/${a}`);c.searchParams.set("token",t);try{let l;const u=Object.assign({upsert:cs.upsert},n),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",u.cacheControl)):(l=r,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType);const h=yield hr(this.fetch,c.toString(),l,{headers:d});return{data:{path:i,fullPath:h.Key},error:null}}catch(l){if(F(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return J(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=yield ce(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:n}),a=new URL(this.url+i.url),c=a.searchParams.get("token");if(!c)throw new Sr("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:c},error:null}}catch(r){if(F(r))return{data:null,error:r};throw r}})}update(e,t,r){return J(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return J(this,void 0,void 0,function*(){try{return{data:yield ce(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(F(n))return{data:null,error:n};throw n}})}copy(e,t,r){return J(this,void 0,void 0,function*(){try{return{data:{path:(yield ce(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(F(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,r){return J(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield ce(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const a=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(n){if(F(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,r){return J(this,void 0,void 0,function*(){try{const n=yield ce(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(n){if(F(n))return{data:null,error:n};throw n}})}download(e,t){return J(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=i?`?${i}`:"";try{const c=this._getFinalPath(e);return{data:yield(yield bt(this.fetch,`${this.url}/${n}/${c}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(c){if(F(c))return{data:null,error:c};throw c}})}info(e){return J(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield bt(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ur(r),error:null}}catch(r){if(F(r))return{data:null,error:r};throw r}})}exists(e){return J(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Yo(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(F(r)&&r instanceof dr){const n=r.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const c=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&n.push(l);let u=n.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${c}/public/${r}${u}`)}}}remove(e){return J(this,void 0,void 0,function*(){try{return{data:yield nn(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(F(t))return{data:null,error:t};throw t}})}list(e,t,r){return J(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Qo),t),{prefix:e||""});return{data:yield ce(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(F(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Zo="2.10.4",el={"X-Client-Info":`storage-js/${Zo}`};var Ae=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function c(d){try{u(r.next(d))}catch(h){a(h)}}function l(d){try{u(r.throw(d))}catch(h){a(h)}}function u(d){d.done?i(d.value):n(d.value).then(c,l)}u((r=r.apply(s,e||[])).next())})};class tl{constructor(e,t={},r,n){const i=new URL(e);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href,this.headers=Object.assign(Object.assign({},el),t),this.fetch=sn(r)}listBuckets(){return Ae(this,void 0,void 0,function*(){try{return{data:yield bt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(F(e))return{data:null,error:e};throw e}})}getBucket(e){return Ae(this,void 0,void 0,function*(){try{return{data:yield bt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(F(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Ae(this,void 0,void 0,function*(){try{return{data:yield ce(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(F(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Ae(this,void 0,void 0,function*(){try{return{data:yield hr(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(F(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Ae(this,void 0,void 0,function*(){try{return{data:yield ce(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(F(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Ae(this,void 0,void 0,function*(){try{return{data:yield nn(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(F(t))return{data:null,error:t};throw t}})}}class rl extends tl{constructor(e,t={},r,n){super(e,t,r,n)}from(e){return new Xo(this.url,this.headers,e,this.fetch)}}const sl="2.53.0";let Je="";typeof Deno<"u"?Je="deno":typeof document<"u"?Je="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Je="react-native":Je="node";const nl={"X-Client-Info":`supabase-js-${Je}/${sl}`},il={headers:nl},al={schema:"public"},ol={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ll={};var cl=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function c(d){try{u(r.next(d))}catch(h){a(h)}}function l(d){try{u(r.throw(d))}catch(h){a(h)}}function u(d){d.done?i(d.value):n(d.value).then(c,l)}u((r=r.apply(s,e||[])).next())})};const dl=s=>{let e;return s?e=s:typeof fetch>"u"?e=qs:e=fetch,(...t)=>e(...t)},ul=()=>typeof Headers>"u"?Ws:Headers,hl=(s,e,t)=>{const r=dl(t),n=ul();return(i,a)=>cl(void 0,void 0,void 0,function*(){var c;const l=(c=yield e())!==null&&c!==void 0?c:s;let u=new n(a==null?void 0:a.headers);return u.has("apikey")||u.set("apikey",s),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),r(i,Object.assign(Object.assign({},a),{headers:u}))})};var fl=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function c(d){try{u(r.next(d))}catch(h){a(h)}}function l(d){try{u(r.throw(d))}catch(h){a(h)}}function u(d){d.done?i(d.value):n(d.value).then(c,l)}u((r=r.apply(s,e||[])).next())})};function ml(s){return s.endsWith("/")?s:s+"/"}function gl(s,e){var t,r;const{db:n,auth:i,realtime:a,global:c}=s,{db:l,auth:u,realtime:d,global:h}=e,f={db:Object.assign(Object.assign({},l),n),auth:Object.assign(Object.assign({},u),i),realtime:Object.assign(Object.assign({},d),a),storage:{},global:Object.assign(Object.assign(Object.assign({},h),c),{headers:Object.assign(Object.assign({},(t=h==null?void 0:h.headers)!==null&&t!==void 0?t:{}),(r=c==null?void 0:c.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>fl(this,void 0,void 0,function*(){return""})};return s.accessToken?f.accessToken=s.accessToken:delete f.accessToken,f}const an="2.71.1",Ue=30*1e3,fr=3,Kt=fr*Ue,pl="http://localhost:9999",vl="supabase.auth.token",yl={"X-Client-Info":`gotrue-js/${an}`},mr="X-Supabase-Api-Version",on={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},bl=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,wl=10*60*1e3;class Er extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function E(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class xl extends Er{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function _l(s){return E(s)&&s.name==="AuthApiError"}class ln extends Er{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class be extends Er{constructor(e,t,r,n){super(e,r,n),this.name=t,this.status=r}}class me extends be{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function jl(s){return E(s)&&s.name==="AuthSessionMissingError"}class ht extends be{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ft extends be{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class mt extends be{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function kl(s){return E(s)&&s.name==="AuthImplicitGrantRedirectError"}class ds extends be{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class gr extends be{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Gt(s){return E(s)&&s.name==="AuthRetryableFetchError"}class us extends be{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class pr extends be{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const wt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),hs=` 	
\r=`.split(""),Sl=(()=>{const s=new Array(128);for(let e=0;e<s.length;e+=1)s[e]=-1;for(let e=0;e<hs.length;e+=1)s[hs[e].charCodeAt(0)]=-2;for(let e=0;e<wt.length;e+=1)s[wt[e].charCodeAt(0)]=e;return s})();function fs(s,e,t){if(s!==null)for(e.queue=e.queue<<8|s,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(wt[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(wt[r]),e.queuedBits-=6}}function cn(s,e,t){const r=Sl[s];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function ms(s){const e=[],t=a=>{e.push(String.fromCodePoint(a))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=a=>{Ol(a,r,t)};for(let a=0;a<s.length;a+=1)cn(s.charCodeAt(a),n,i);return e.join("")}function El(s,e){if(s<=127){e(s);return}else if(s<=2047){e(192|s>>6),e(128|s&63);return}else if(s<=65535){e(224|s>>12),e(128|s>>6&63),e(128|s&63);return}else if(s<=1114111){e(240|s>>18),e(128|s>>12&63),e(128|s>>6&63),e(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function Tl(s,e){for(let t=0;t<s.length;t+=1){let r=s.charCodeAt(t);if(r>55295&&r<=56319){const n=(r-55296)*1024&65535;r=(s.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}El(r,e)}}function Ol(s,e,t){if(e.utf8seq===0){if(s<=127){t(s);return}for(let r=1;r<6;r+=1)if(!(s>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=s&31;else if(e.utf8seq===3)e.codepoint=s&15;else if(e.utf8seq===4)e.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|s&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Nl(s){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};for(let n=0;n<s.length;n+=1)cn(s.charCodeAt(n),t,r);return new Uint8Array(e)}function Cl(s){const e=[];return Tl(s,t=>e.push(t)),new Uint8Array(e)}function Pl(s){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};return s.forEach(n=>fs(n,t,r)),fs(null,t,r),e.join("")}function Al(s){return Math.round(Date.now()/1e3)+s}function Rl(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s=="x"?e:e&3|8).toString(16)})}const ee=()=>typeof window<"u"&&typeof document<"u",xe={tested:!1,writable:!1},dn=()=>{if(!ee())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(xe.tested)return xe.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),xe.tested=!0,xe.writable=!0}catch{xe.tested=!0,xe.writable=!1}return xe.writable};function $l(s){const e={},t=new URL(s);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((r,n)=>{e[n]=r}),e}const un=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>tt(async()=>{const{default:r}=await Promise.resolve().then(()=>We);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Il=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",Le=async(s,e,t)=>{await s.setItem(e,JSON.stringify(t))},_e=async(s,e)=>{const t=await s.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},fe=async(s,e)=>{await s.removeItem(e)};class Nt{constructor(){this.promise=new Nt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Nt.promiseConstructor=Promise;function zt(s){const e=s.split(".");if(e.length!==3)throw new pr("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!bl.test(e[r]))throw new pr("JWT not in base64url format");return{header:JSON.parse(ms(e[0])),payload:JSON.parse(ms(e[1])),signature:Nl(e[2]),raw:{header:e[0],payload:e[1]}}}async function Dl(s){return await new Promise(e=>{setTimeout(()=>e(null),s)})}function Ul(s,e){return new Promise((r,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await s(i);if(!e(i,null,a)){r(a);return}}catch(a){if(!e(i,a)){n(a);return}}})()})}function Ll(s){return("0"+s.toString(16)).substr(-2)}function Ml(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(e),Array.from(e,Ll).join("")}async function Fl(s){const t=new TextEncoder().encode(s),r=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function Bl(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const t=await Fl(s);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Re(s,e,t=!1){const r=Ml();let n=r;t&&(n+="/PASSWORD_RECOVERY"),await Le(s,`${e}-code-verifier`,n);const i=await Bl(r);return[i,r===i?"plain":"s256"]}const ql=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Wl(s){const e=s.headers.get(mr);if(!e||!e.match(ql))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Hl(s){if(!s)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(s<=e)throw new Error("JWT has expired")}function Vl(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Kl=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function $e(s){if(!Kl.test(s))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Jt(){const s={};return new Proxy(s,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function gs(s){return JSON.parse(JSON.stringify(s))}var Gl=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t};const ke=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),zl=[502,503,504];async function ps(s){var e;if(!Il(s))throw new gr(ke(s),0);if(zl.includes(s.status))throw new gr(ke(s),s.status);let t;try{t=await s.json()}catch(i){throw new ln(ke(i),i)}let r;const n=Wl(s);if(n&&n.getTime()>=on["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new us(ke(t),s.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new me}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new us(ke(t),s.status,t.weak_password.reasons);throw new xl(ke(t),s.status||500,r)}const Jl=(s,e,t,r)=>{const n={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),t))};async function C(s,e,t,r){var n;const i=Object.assign({},r==null?void 0:r.headers);i[mr]||(i[mr]=on["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const a=(n=r==null?void 0:r.query)!==null&&n!==void 0?n:{};r!=null&&r.redirectTo&&(a.redirect_to=r.redirectTo);const c=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await Yl(s,e,t+c,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function Yl(s,e,t,r,n,i){const a=Jl(e,r,n,i);let c;try{c=await s(t,Object.assign({},a))}catch(l){throw console.error(l),new gr(ke(l),0)}if(c.ok||await ps(c),r!=null&&r.noResolveJson)return c;try{return await c.json()}catch(l){await ps(l)}}function oe(s){var e;let t=null;ec(s)&&(t=Object.assign({},s),s.expires_at||(t.expires_at=Al(s.expires_in)));const r=(e=s.user)!==null&&e!==void 0?e:s;return{data:{session:t,user:r},error:null}}function vs(s){const e=oe(s);return!e.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=s.weak_password),e}function ge(s){var e;return{data:{user:(e=s.user)!==null&&e!==void 0?e:s},error:null}}function Ql(s){return{data:s,error:null}}function Xl(s){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:i}=s,a=Gl(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),c={action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:i},l=Object.assign({},a);return{data:{properties:c,user:l},error:null}}function Zl(s){return s}function ec(s){return s.access_token&&s.refresh_token&&s.expires_in}const Yt=["global","local","others"];var tc=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t};class rc{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=un(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Yt[0]){if(Yt.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Yt.join(", ")}`);try{return await C(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(E(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await C(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ge})}catch(r){if(E(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=tc(e,["options"]),n=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(n.new_email=r==null?void 0:r.newEmail,delete n.newEmail),await C(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Xl,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(E(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await C(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ge})}catch(t){if(E(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,n,i,a,c,l;try{const u={nextPage:null,lastPage:0,total:0},d=await C(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Zl});if(d.error)throw d.error;const h=await d.json(),f=(a=d.headers.get("x-total-count"))!==null&&a!==void 0?a:0,m=(l=(c=d.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&l!==void 0?l:[];return m.length>0&&(m.forEach(g=>{const b=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(g.split(";")[1].split("=")[1]);u[`${w}Page`]=b}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},h),u),error:null}}catch(u){if(E(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){$e(e);try{return await C(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ge})}catch(t){if(E(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){$e(e);try{return await C(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ge})}catch(r){if(E(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){$e(e);try{return await C(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ge})}catch(r){if(E(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){$e(e.userId);try{const{data:t,error:r}=await C(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:r}}catch(t){if(E(t))return{data:null,error:t};throw t}}async _deleteFactor(e){$e(e.userId),$e(e.id);try{return{data:await C(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(E(t))return{data:null,error:t};throw t}}}function ys(s={}){return{getItem:e=>s[e]||null,setItem:(e,t)=>{s[e]=t},removeItem:e=>{delete s[e]}}}function sc(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Ie={debug:!!(globalThis&&dn()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class hn extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class nc extends hn{}async function ic(s,e,t){Ie.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Ie.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async n=>{if(n){Ie.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,n.name);try{return await t()}finally{Ie.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,n.name)}}else{if(e===0)throw Ie.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new nc(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(Ie.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}sc();const ac={url:pl,storageKey:vl,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:yl,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function bs(s,e,t){return await t()}const De={};class Ze{constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Ze.nextInstanceID,Ze.nextInstanceID+=1,this.instanceID>0&&ee()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},ac),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new rc({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=un(n.fetch),this.lock=n.lock||bs,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:ee()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=ic:this.lock=bs,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:dn()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=ys(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=ys(this.memoryStorage)),ee()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=De[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){De[this.storageKey]=Object.assign(Object.assign({},De[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=De[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){De[this.storageKey]=Object.assign(Object.assign({},De[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${an}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=$l(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),ee()&&this.detectSessionInUrl&&r!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),kl(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:a,redirectType:c}=n;return this._debug("#_initialize()","detected session in URL",a,"redirect type",c),await this._saveSession(a),setTimeout(async()=>{c==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return E(t)?{error:t}:{error:new ln("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,n;try{const i=await C(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:oe}),{data:a,error:c}=i;if(c||!a)return{data:{user:null,session:null},error:c};const l=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(i){if(E(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,r,n;try{let i;if("email"in e){const{email:d,password:h,options:f}=e;let m=null,g=null;this.flowType==="pkce"&&([m,g]=await Re(this.storage,this.storageKey)),i=await C(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:d,password:h,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:m,code_challenge_method:g},xform:oe})}else if("phone"in e){const{phone:d,password:h,options:f}=e;i=await C(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:h,data:(r=f==null?void 0:f.data)!==null&&r!==void 0?r:{},channel:(n=f==null?void 0:f.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:oe})}else throw new ft("You must provide either an email or phone number and a password");const{data:a,error:c}=i;if(c||!a)return{data:{user:null,session:null},error:c};const l=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(i){if(E(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:a,options:c}=e;t=await C(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:vs})}else if("phone"in e){const{phone:i,password:a,options:c}=e;t=await C(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:vs})}else throw new ft("You must provide either an email or phone number and a password");const{data:r,error:n}=t;return n?{data:{user:null,session:null},error:n}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new ht}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(t){if(E(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,n,i,a,c,l,u,d,h,f,m;let g,b;if("message"in e)g=e.message,b=e.signature;else{const{chain:w,wallet:v,statement:T,options:y}=e;let _;if(ee())if(typeof v=="object")_=v;else{const p=window;if("solana"in p&&typeof p.solana=="object"&&("signIn"in p.solana&&typeof p.solana.signIn=="function"||"signMessage"in p.solana&&typeof p.solana.signMessage=="function"))_=p.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!(y!=null&&y.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");_=v}const j=new URL((t=y==null?void 0:y.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in _&&_.signIn){const p=await _.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},y==null?void 0:y.signInWithSolana),{version:"1",domain:j.host,uri:j.href}),T?{statement:T}:null));let k;if(Array.isArray(p)&&p[0]&&typeof p[0]=="object")k=p[0];else if(p&&typeof p=="object"&&"signedMessage"in p&&"signature"in p)k=p;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in k&&"signature"in k&&(typeof k.signedMessage=="string"||k.signedMessage instanceof Uint8Array)&&k.signature instanceof Uint8Array)g=typeof k.signedMessage=="string"?k.signedMessage:new TextDecoder().decode(k.signedMessage),b=k.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in _)||typeof _.signMessage!="function"||!("publicKey"in _)||typeof _!="object"||!_.publicKey||!("toBase58"in _.publicKey)||typeof _.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${j.host} wants you to sign in with your Solana account:`,_.publicKey.toBase58(),...T?["",T,""]:[""],"Version: 1",`URI: ${j.href}`,`Issued At: ${(n=(r=y==null?void 0:y.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((i=y==null?void 0:y.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${y.signInWithSolana.notBefore}`]:[],...!((a=y==null?void 0:y.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${y.signInWithSolana.expirationTime}`]:[],...!((c=y==null?void 0:y.signInWithSolana)===null||c===void 0)&&c.chainId?[`Chain ID: ${y.signInWithSolana.chainId}`]:[],...!((l=y==null?void 0:y.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${y.signInWithSolana.nonce}`]:[],...!((u=y==null?void 0:y.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${y.signInWithSolana.requestId}`]:[],...!((h=(d=y==null?void 0:y.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||h===void 0)&&h.length?["Resources",...y.signInWithSolana.resources.map(k=>`- ${k}`)]:[]].join(`
`);const p=await _.signMessage(new TextEncoder().encode(g),"utf8");if(!p||!(p instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");b=p}}try{const{data:w,error:v}=await C(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:Pl(b)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(m=e.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:oe});if(v)throw v;return!w||!w.session||!w.user?{data:{user:null,session:null},error:new ht}:(w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),{data:Object.assign({},w),error:v})}catch(w){if(E(w))return{data:{user:null,session:null},error:w};throw w}}async _exchangeCodeForSession(e){const t=await _e(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(t??"").split("/");try{const{data:i,error:a}=await C(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:oe});if(await fe(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new ht}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:a})}catch(i){if(E(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:r,token:n,access_token:i,nonce:a}=e,c=await C(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:oe}),{data:l,error:u}=c;return u?{data:{user:null,session:null},error:u}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new ht}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:u})}catch(t){if(E(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,n,i,a;try{if("email"in e){const{email:c,options:l}=e;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await Re(this.storage,this.storageKey));const{error:h}=await C(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:c,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:c,options:l}=e,{data:u,error:d}=await C(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:c,data:(n=l==null?void 0:l.data)!==null&&n!==void 0?n:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(a=l==null?void 0:l.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:d}}throw new ft("You must provide either an email or phone number.")}catch(c){if(E(c))return{data:{user:null,session:null},error:c};throw c}}async verifyOtp(e){var t,r;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:a,error:c}=await C(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:oe});if(c)throw c;if(!a)throw new Error("An error occurred on token verification.");const l=a.session,u=a.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(n){if(E(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,r,n;try{let i=null,a=null;return this.flowType==="pkce"&&([i,a]=await Re(this.storage,this.storageKey)),await C(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:Ql})}catch(i){if(E(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new me;const{error:n}=await C(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(E(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:n,options:i}=e,{error:a}=await C(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:r,type:n,options:i}=e,{data:a,error:c}=await C(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:c}}throw new ft("You must provide either an email or phone number and a type")}catch(t){if(E(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await _e(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Kt:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const a=await _e(this.userStorage,this.storageKey+"-user");a!=null&&a.user?e.user=a.user:e.user=Jt()}if(this.storage.isServer&&e.user){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,u,d)=>(!a&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,u,d))})}return{data:{session:e},error:null}}const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await C(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ge}):await this._useSession(async t=>{var r,n,i;const{data:a,error:c}=t;if(c)throw c;return!(!((r=a.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new me}:await C(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=a.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:ge})})}catch(t){if(E(t))return jl(t)&&(await this._removeSession(),await fe(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:n,error:i}=r;if(i)throw i;if(!n.session)throw new me;const a=n.session;let c=null,l=null;this.flowType==="pkce"&&e.email!=null&&([c,l]=await Re(this.storage,this.storageKey));const{data:u,error:d}=await C(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:c,code_challenge_method:l}),jwt:a.access_token,xform:ge});if(d)throw d;return a.user=u.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(r){if(E(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new me;const t=Date.now()/1e3;let r=t,n=!0,i=null;const{payload:a}=zt(e.access_token);if(a.exp&&(r=a.exp,n=r<=t),n){const{session:c,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!c)return{data:{user:null,session:null},error:null};i=c}else{const{data:c,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:c.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(E(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:a,error:c}=t;if(c)throw c;e=(r=a.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new me;const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(E(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!ee())throw new mt("No browser detected.");if(e.error||e.error_description||e.error_code)throw new mt(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new ds("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new mt("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new ds("No code detected.");const{data:T,error:y}=await this._exchangeCodeForSession(e.code);if(y)throw y;const _=new URL(window.location.href);return _.searchParams.delete("code"),window.history.replaceState(window.history.state,"",_.toString()),{data:{session:T.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:i,refresh_token:a,expires_in:c,expires_at:l,token_type:u}=e;if(!i||!c||!a||!u)throw new mt("No session defined in URL");const d=Math.round(Date.now()/1e3),h=parseInt(c);let f=d+h;l&&(f=parseInt(l));const m=f-d;m*1e3<=Ue&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${h}s`);const g=f-h;d-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,f,d):d-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,f,d);const{data:b,error:w}=await this._getUser(i);if(w)throw w;const v={provider_token:r,provider_refresh_token:n,access_token:i,expires_in:h,expires_at:f,refresh_token:a,token_type:u,user:b.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:v,redirectType:e.type},error:null}}catch(r){if(E(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await _e(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:n,error:i}=t;if(i)return{error:i};const a=(r=n.session)===null||r===void 0?void 0:r.access_token;if(a){const{error:c}=await this.admin.signOut(a,e);if(c&&!(_l(c)&&(c.status===404||c.status===401||c.status===403)))return{error:c}}return e!=="others"&&(await this._removeSession(),await fe(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Rl(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,n;try{const{data:{session:i},error:a}=t;if(a)throw a;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let r=null,n=null;this.flowType==="pkce"&&([r,n]=await Re(this.storage,this.storageKey,!0));try{return await C(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(E(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(E(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:n}=await this._useSession(async i=>{var a,c,l,u,d;const{data:h,error:f}=i;if(f)throw f;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(c=e.options)===null||c===void 0?void 0:c.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await C(this.fetch,"GET",m,{headers:this.headers,jwt:(d=(u=h.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(n)throw n;return ee()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(E(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,n;const{data:i,error:a}=t;if(a)throw a;return await C(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(E(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await Ul(async n=>(n>0&&await Dl(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await C(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:oe})),(n,i)=>{const a=200*Math.pow(2,n);return i&&Gt(i)&&Date.now()+a-r<Ue})}catch(r){if(this._debug(t,"error",r),E(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),ee()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const n=await _e(this.storage,this.storageKey);if(n&&this.userStorage){let a=await _e(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:n.user},await Le(this.userStorage,this.storageKey+"-user",a)),n.user=(e=a==null?void 0:a.user)!==null&&e!==void 0?e:Jt()}else if(n&&!n.user&&!n.user){const a=await _e(this.storage,this.storageKey+"-user");a&&(a!=null&&a.user)?(n.user=a.user,await fe(this.storage,this.storageKey+"-user"),await Le(this.storage,this.storageKey,n)):n.user=Jt()}if(this._debug(r,"session from storage",n),!this._isValidSession(n)){this._debug(r,"session is not valid"),n!==null&&await this._removeSession();return}const i=((t=n.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Kt;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${Kt}s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:a}=await this._callRefreshToken(n.refresh_token);a&&(console.error(a),Gt(a)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:c}=await this._getUser(n.access_token);!c&&(a!=null&&a.user)?(n.user=a.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(r,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(r,"error",n),console.error(n);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new me;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Nt;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new me;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const c={session:i.session,error:null};return this.refreshingDeferred.resolve(c),c}catch(i){if(this._debug(n,"error",i),E(i)){const a={session:null,error:i};return Gt(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,r=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async c=>{try{await c.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(a),i.length>0){for(let c=0;c<i.length;c+=1)console.error(i[c]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&await Le(this.userStorage,this.storageKey+"-user",{user:t.user});const n=Object.assign({},t);delete n.user;const i=gs(n);await Le(this.storage,this.storageKey,i)}else{const n=gs(t);await Le(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),await fe(this.storage,this.storageKey),await fe(this.storage,this.storageKey+"-code-verifier"),await fe(this.storage,this.storageKey+"-user"),this.userStorage&&await fe(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ee()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ue);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((r.expires_at*1e3-e)/Ue);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${Ue}ms, refresh threshold is ${fr} ticks`),n<=fr&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof hn)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ee()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const n=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,a]=await Re(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});n.push(c.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);n.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;return i?{data:null,error:i}:await C(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(E(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,n;const{data:i,error:a}=t;if(a)return{data:null,error:a};const c=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:u}=await C(this.fetch,"POST",`${this.url}/factors`,{body:c,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((n=l==null?void 0:l.totp)===null||n===void 0)&&n.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(E(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;if(i)return{data:null,error:i};const{data:a,error:c}=await C(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:c})})}catch(t){if(E(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;return i?{data:null,error:i}:await C(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(E(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],n=r.filter(a=>a.factor_type==="totp"&&a.status==="verified"),i=r.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:r,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=zt(n.access_token);let c=null;a.aal&&(c=a.aal);let l=c;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const d=a.amr||[];return{data:{currentLevel:c,nextLevel:l,currentAuthenticationMethods:d},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(c=>c.kid===e);if(r)return r;const n=Date.now();if(r=this.jwks.keys.find(c=>c.kid===e),r&&this.jwks_cached_at+wl>n)return r;const{data:i,error:a}=await C(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=n,r=i.keys.find(c=>c.kid===e),!r)?null:r}async getClaims(e,t={}){try{let r=e;if(!r){const{data:m,error:g}=await this.getSession();if(g||!m.session)return{data:null,error:g};r=m.session.access_token}const{header:n,payload:i,signature:a,raw:{header:c,payload:l}}=zt(r);t!=null&&t.allowExpired||Hl(i.exp);const u=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!u){const{error:m}=await this.getUser(r);if(m)throw m;return{data:{claims:i,header:n,signature:a},error:null}}const d=Vl(n.alg),h=await crypto.subtle.importKey("jwk",u,d,!0,["verify"]);if(!await crypto.subtle.verify(d,h,a,Cl(`${c}.${l}`)))throw new pr("Invalid JWT signature");return{data:{claims:i,header:n,signature:a},error:null}}catch(r){if(E(r))return{data:null,error:r};throw r}}}Ze.nextInstanceID=0;const oc=Ze;class lc extends oc{constructor(e){super(e)}}var cc=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function c(d){try{u(r.next(d))}catch(h){a(h)}}function l(d){try{u(r.throw(d))}catch(h){a(h)}}function u(d){d.done?i(d.value):n(d.value).then(c,l)}u((r=r.apply(s,e||[])).next())})};class dc{constructor(e,t,r){var n,i,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const c=ml(e),l=new URL(c);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const u=`sb-${l.hostname.split(".")[0]}-auth-token`,d={db:al,realtime:ll,auth:Object.assign(Object.assign({},ol),{storageKey:u}),global:il},h=gl(r??{},d);this.storageKey=(n=h.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=h.global.headers)!==null&&i!==void 0?i:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(f,m)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(m)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=h.auth)!==null&&a!==void 0?a:{},this.headers,h.global.fetch),this.fetch=hl(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new Oo(new URL("rest/v1",l).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new rl(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new so(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return cc(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,storageKey:i,flowType:a,lock:c,debug:l},u,d){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new lc({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),u),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,flowType:a,lock:c,debug:l,fetch:d,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Wo(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const uc=(s,e,t)=>new dc(s,e,t);function hc(){if(typeof window<"u"||typeof process>"u"||process.version===void 0||process.version===null)return!1;const s=process.version.match(/^v(\d+)\./);return s?parseInt(s[1],10)<=18:!1}hc()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Qt={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},ws=(s,e)=>(Qt==null?void 0:Qt[s])||e,xs={url:ws("VITE_SUPABASE_URL","https://your-project.supabase.co"),anonKey:ws("VITE_SUPABASE_ANON_KEY","your-anon-key")},fc=uc(xs.url,xs.anonKey,{auth:{persistSession:!0,autoRefreshToken:!0},realtime:{params:{eventsPerSecond:10}}});class fn{constructor(){Rt(this,"client");Rt(this,"channels",new Map);this.client=fc}subscribeToTable(e,t,r){var a;const n=`${e}_${(r==null?void 0:r.column)||"all"}`;this.channels.has(n)&&((a=this.channels.get(n))==null||a.unsubscribe());const i=this.client.channel(n).on("postgres_changes",{event:"*",schema:"public",table:e,...r&&{filter:`${r.column}=eq.${r.value}`}},t).subscribe();return this.channels.set(n,i),i}unsubscribe(e){var t;e&&this.channels.has(e)?((t=this.channels.get(e))==null||t.unsubscribe(),this.channels.delete(e)):(this.channels.forEach(r=>r.unsubscribe()),this.channels.clear())}async getComponentData(e,t={}){try{const{data:r,error:n}=await this.client.rpc("get_component_data",{component_type:e,filters:t});if(n)throw n;return r}catch(r){throw console.error(`Error fetching ${e} data:`,r),r}}async updateComponentConfig(e,t){try{const{data:r,error:n}=await this.client.from("component_configs").update({config_data:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(n)throw n;return r}catch(r){throw console.error("Error updating component config:",r),r}}async logComponentUsage(e,t,r={}){try{const{error:n}=await this.client.from("component_usage_logs").insert({component_id:e,feishu_user_id:this.getCurrentFeishuUserId(),action_type:t,action_data:r,ip_address:await this.getClientIP(),user_agent:navigator.userAgent});if(n)throw n}catch(n){console.error("Error logging component usage:",n)}}getCurrentFeishuUserId(){return new URLSearchParams(window.location.search).get("feishu_user_id")||localStorage.getItem("feishu_user_id")}async getClientIP(){try{return(await(await fetch("https://api.ipify.org?format=json")).json()).ip}catch{return null}}}class mc extends fn{async getRealTimeMetrics(e=[]){try{let t=this.client.from("realtime_metrics").select("*").gte("expires_at",new Date().toISOString()).order("calculated_at",{ascending:!1});e.length>0&&(t=t.in("metric_name",e));const{data:r,error:n}=await t;if(n)throw n;const i=new Map;return r==null||r.forEach(a=>{i.set(a.metric_name,{value:a.metric_value,calculatedAt:a.calculated_at,expiresAt:a.expires_at})}),Object.fromEntries(i)}catch(t){throw console.error("Error fetching real-time metrics:",t),t}}subscribeToMetrics(e){return this.subscribeToTable("realtime_metrics",async()=>{const t=await this.getRealTimeMetrics();e(t)})}}const V=new fn,_s=new mc,gc=({feishuContext:s,className:e="",autoRefresh:t=!0,refreshInterval:r=3e4})=>{var v,T,y,_,j,p,k,O,B,L,N,x;const[n,i]=P.useState("7d"),[a,c]=P.useState(null),{data:l,error:u,mutate:d}=Me("realtime-metrics",()=>_s.getRealTimeMetrics(["dau","new_users_today","conversion_rate","daily_revenue","active_rate"]),{refreshInterval:t?r:0,revalidateOnFocus:!1}),{data:h,error:f}=Me(["user-growth",n],()=>V.getComponentData("dashboard",{type:"user_growth_trend",timeRange:n}),{refreshInterval:t?r:0}),{data:m,error:g}=Me("user-analytics",()=>V.getComponentData("dashboard",{type:"user_analytics"}),{refreshInterval:t?r:0});P.useEffect(()=>{if(!t)return;const S=_s.subscribeToMetrics(R=>{c(R),d()});return()=>{S==null||S.unsubscribe()}},[t,d]),P.useEffect(()=>{V.logComponentUsage("dashboard","view",{timeRange:n,feishuUserId:s==null?void 0:s.userId})},[n,s]);const b=async()=>{try{const S={metrics:l,userGrowthData:h,userAnalytics:m,exportedAt:new Date().toISOString(),exportedBy:s==null?void 0:s.userId},R=new Blob([JSON.stringify(S,null,2)],{type:"application/json"}),re=URL.createObjectURL(R),ue=document.createElement("a");ue.href=re,ue.download=`dashboard-data-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(ue),ue.click(),document.body.removeChild(ue),URL.revokeObjectURL(re),await V.logComponentUsage("dashboard","export",{dataTypes:["metrics","userGrowth","analytics"],timeRange:n})}catch(S){console.error("Export failed:",S)}},w=S=>S?S.map(R=>({timestamp:R.date,value:R.users,label:`${R.users} 用户`})):[];return o.jsxs("div",{className:`min-h-screen bg-bg-secondary ${e}`,children:[o.jsx("div",{className:"bg-bg-primary border-b border-border-primary px-6 py-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsxs("h1",{className:"text-2xl font-bold text-text-primary flex items-center",children:[o.jsx(Ir,{className:"w-6 h-6 mr-2 text-accent-primary"}),"实时数据看板"]}),o.jsxs("p",{className:"text-sm text-text-tertiary mt-1",children:["星趣App运营数据实时监控 •",a?o.jsx("span",{className:"text-accent-primary",children:"● 实时更新"}):o.jsx("span",{className:"text-text-tertiary",children:"○ 等待连接"})]})]}),o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsxs("select",{value:n,onChange:S=>i(S.target.value),className:"px-3 py-2 border border-border-primary rounded-lg text-sm bg-bg-primary text-text-primary",children:[o.jsx("option",{value:"24h",children:"最近24小时"}),o.jsx("option",{value:"7d",children:"最近7天"}),o.jsx("option",{value:"30d",children:"最近30天"})]}),o.jsxs("button",{onClick:b,className:"flex items-center px-3 py-2 bg-accent-primary text-white rounded-lg hover:bg-accent-hover transition-colors text-sm",children:[o.jsx(yr,{className:"w-4 h-4 mr-1"}),"导出数据"]})]})]})}),o.jsxs("div",{className:"px-6 py-6",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[o.jsx(ut,{title:"日活用户",value:((v=l==null?void 0:l.dau)==null?void 0:v.value)||0,change:((T=l==null?void 0:l.dau)==null?void 0:T.change)||"+0%",trend:((y=l==null?void 0:l.dau)==null?void 0:y.trend)||"neutral",icon:o.jsx(gt,{className:"w-5 h-5"}),loading:!l&&!u}),o.jsx(ut,{title:"新增用户",value:((_=l==null?void 0:l.new_users_today)==null?void 0:_.value)||0,change:((j=l==null?void 0:l.new_users_today)==null?void 0:j.change)||"+0%",trend:((p=l==null?void 0:l.new_users_today)==null?void 0:p.trend)||"neutral",icon:o.jsx(ks,{className:"w-5 h-5"}),loading:!l&&!u}),o.jsx(ut,{title:"付费转化率",value:((k=l==null?void 0:l.conversion_rate)==null?void 0:k.value)||0,suffix:"%",change:((O=l==null?void 0:l.conversion_rate)==null?void 0:O.change)||"+0%",trend:((B=l==null?void 0:l.conversion_rate)==null?void 0:B.trend)||"neutral",icon:o.jsx($n,{className:"w-5 h-5"}),loading:!l&&!u}),o.jsx(ut,{title:"今日收入",value:((L=l==null?void 0:l.daily_revenue)==null?void 0:L.value)||0,prefix:"¥",change:((N=l==null?void 0:l.daily_revenue)==null?void 0:N.change)||"+0%",trend:((x=l==null?void 0:l.daily_revenue)==null?void 0:x.trend)||"neutral",icon:o.jsx(Ss,{className:"w-5 h-5"}),loading:!l&&!u})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[o.jsx(Yr,{title:"用户增长趋势",subtitle:`${n==="24h"?"24小时":n==="7d"?"7天":"30天"}数据趋势`,loading:!h&&!f,error:f==null?void 0:f.message,onRefresh:()=>window.location.reload(),onExport:b,height:350,children:o.jsx(Qa,{data:w(h),variant:"area",animate:!0})}),o.jsx(Yr,{title:"用户构成分析",subtitle:"用户类型和活跃度分布",loading:!m&&!g,error:g==null?void 0:g.message,height:350,children:o.jsx("div",{className:"h-full flex items-center justify-center text-text-tertiary",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Es,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),o.jsx("p",{children:"用户分布图表"}),o.jsx("p",{className:"text-sm mt-1",children:"开发中..."})]})})})]}),o.jsxs("div",{className:"bg-bg-primary border border-border-primary rounded-lg p-6",children:[o.jsxs("h3",{className:"text-lg font-semibold text-text-primary mb-4 flex items-center",children:[o.jsx(Ir,{className:"w-5 h-5 mr-2 text-accent-primary"}),"实时活动",a&&o.jsx("span",{className:"ml-2 px-2 py-1 bg-accent-light text-accent-primary text-xs rounded-full",children:"LIVE"})]}),o.jsx("div",{className:"space-y-3",children:[{time:"2分钟前",event:"新用户注册",detail:"user_12345 完成注册",type:"success"},{time:"5分钟前",event:"会员升级",detail:"user_67890 升级为高级会员",type:"info"},{time:"8分钟前",event:"AI对话开始",detail:"与角色 小雅 开始对话",type:"neutral"},{time:"12分钟前",event:"内容创作",detail:"发布新的故事内容",type:"success"}].map((S,R)=>o.jsxs("div",{className:"flex items-start space-x-3 p-3 hover:bg-bg-hover rounded-lg transition-colors",children:[o.jsx("div",{className:`w-2 h-2 rounded-full mt-2 ${S.type==="success"?"bg-status-success":S.type==="info"?"bg-status-info":"bg-border-primary"}`}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("p",{className:"text-sm font-medium text-text-primary",children:S.event}),o.jsx("span",{className:"text-xs text-text-tertiary",children:S.time})]}),o.jsx("p",{className:"text-sm text-text-secondary mt-1",children:S.detail})]})]},R))})]})]})]})};var pc=function(s,e){for(var t={};s.length;){var r=s[0],n=r.code,i=r.message,a=r.path.join(".");if(!t[a])if("unionErrors"in r){var c=r.unionErrors[0].errors[0];t[a]={message:c.message,type:c.code}}else t[a]={message:i,type:n};if("unionErrors"in r&&r.unionErrors.forEach(function(d){return d.errors.forEach(function(h){return s.push(h)})}),e){var l=t[a].types,u=l&&l[r.code];t[a]=Jn(a,e,t,n,u?[].concat(u,r.message):r.message)}s.shift()}return t},vc=function(s,e,t){return t===void 0&&(t={}),function(r,n,i){try{return Promise.resolve(function(a,c){try{var l=Promise.resolve(s[t.mode==="sync"?"parse":"parseAsync"](r,e)).then(function(u){return i.shouldUseNativeValidation&&Gn({},i),{errors:{},values:t.raw?r:u}})}catch(u){return c(u)}return l&&l.then?l.then(void 0,c):l}(0,function(a){if(function(c){return Array.isArray(c==null?void 0:c.errors)}(a))return{values:{},errors:zn(pc(a.errors,!i.shouldUseNativeValidation&&i.criteriaMode==="all"),i)};throw a}))}catch(a){return Promise.reject(a)}}};const yc=Yn({search:Qn().optional(),membershipLevel:It(["all","free","basic","premium","lifetime"]).default("all"),dateRange:It(["all","24h","7d","30d"]).default("all"),status:It(["all","active","inactive"]).default("all")}),bc=({feishuContext:s,className:e=""})=>{const[t,r]=P.useState([]),[n,i]=P.useState({field:"createdAt",direction:"desc"}),[a,c]=P.useState(1),l=20,u=Xn({resolver:vc(yc),defaultValues:{search:"",membershipLevel:"all",dateRange:"all",status:"all"}}),d=u.watch(),h=P.useMemo(()=>{const p={page:a,pageSize:l,sort:n};return d.search&&(p.search=d.search),d.membershipLevel!=="all"&&(p.membershipLevel=d.membershipLevel),d.dateRange!=="all"&&(p.dateRange=d.dateRange),d.status!=="all"&&(p.status=d.status),p},[a,n,d]),{data:f,error:m,mutate:g}=Me(["users",h],()=>V.getComponentData("user_management",h)),b=(f==null?void 0:f.items)||[],w=(f==null?void 0:f.total)||0,v={free:{label:"免费用户",color:"text-text-tertiary",bgColor:"bg-bg-tertiary"},basic:{label:"基础会员",color:"text-status-info",bgColor:"bg-blue-50"},premium:{label:"高级会员",color:"text-status-warning",bgColor:"bg-orange-50"},lifetime:{label:"终身会员",color:"text-status-success",bgColor:"bg-accent-light"}},T=p=>{i(k=>({field:p,direction:k.field===p&&k.direction==="asc"?"desc":"asc"}))},y=async(p,k)=>{try{await V.getComponentData("user_management",{action:k,userId:p,operatorId:s==null?void 0:s.userId}),g(),await V.logComponentUsage("user_management",k,{userId:p,operator:s==null?void 0:s.userId})}catch(O){console.error(`Failed to ${k} user:`,O)}},_=async p=>{if(t.length!==0)try{await V.getComponentData("user_management",{action:`batch_${p}`,userIds:t,operatorId:s==null?void 0:s.userId}),g(),r([]),await V.logComponentUsage("user_management",`batch_${p}`,{userCount:t.length,operator:s==null?void 0:s.userId})}catch(k){console.error(`Failed to batch ${p}:`,k)}},j=async()=>{try{const p=b.map(N=>({用户ID:N.id,昵称:N.nickname,手机号:N.phone,会员等级:v[N.membershipLevel].label,注册时间:ve(new Date(N.createdAt),"yyyy-MM-dd HH:mm:ss"),最后活跃:ve(new Date(N.lastSeenAt),"yyyy-MM-dd HH:mm:ss"),星点余额:N.starPointsBalance,总消费:N.totalSpent})),k=[Object.keys(p[0]).join(","),...p.map(N=>Object.values(N).join(","))].join(`
`),O=new Blob([k],{type:"text/csv;charset=utf-8;"}),B=URL.createObjectURL(O),L=document.createElement("a");L.href=B,L.download=`users-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(B),await V.logComponentUsage("user_management","export",{userCount:b.length,filters:h})}catch(p){console.error("Export failed:",p)}};return o.jsxs("div",{className:`min-h-screen bg-bg-secondary ${e}`,children:[o.jsx("div",{className:"bg-bg-primary border-b border-border-primary px-6 py-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsxs("h1",{className:"text-2xl font-bold text-text-primary flex items-center",children:[o.jsx(gt,{className:"w-6 h-6 mr-2 text-accent-primary"}),"用户管理中心"]}),o.jsxs("p",{className:"text-sm text-text-tertiary mt-1",children:["管理和分析用户数据 • 总计 ",w.toLocaleString()," 用户"]})]}),o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsxs("button",{onClick:j,className:"flex items-center px-3 py-2 border border-border-primary rounded-lg hover:bg-bg-hover transition-colors text-sm",children:[o.jsx(yr,{className:"w-4 h-4 mr-1"}),"导出数据"]}),o.jsxs("button",{className:"flex items-center px-3 py-2 bg-accent-primary text-white rounded-lg hover:bg-accent-hover transition-colors text-sm",children:[o.jsx(In,{className:"w-4 h-4 mr-1"}),"添加用户"]})]})]})}),o.jsx("div",{className:"bg-bg-primary border-b border-border-secondary px-6 py-4",children:o.jsxs("div",{className:"flex items-center justify-between space-x-4",children:[o.jsxs("div",{className:"flex items-center space-x-4 flex-1",children:[o.jsxs("div",{className:"relative flex-1 max-w-md",children:[o.jsx(Dn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-text-tertiary w-4 h-4"}),o.jsx("input",{type:"text",placeholder:"搜索用户昵称或手机号...",className:"pl-10 pr-4 py-2 w-full border border-border-primary rounded-lg focus:ring-2 focus:ring-accent-primary focus:border-transparent",...u.register("search")})]}),o.jsxs("select",{className:"px-3 py-2 border border-border-primary rounded-lg text-sm bg-bg-primary",...u.register("membershipLevel"),children:[o.jsx("option",{value:"all",children:"全部等级"}),o.jsx("option",{value:"free",children:"免费用户"}),o.jsx("option",{value:"basic",children:"基础会员"}),o.jsx("option",{value:"premium",children:"高级会员"}),o.jsx("option",{value:"lifetime",children:"终身会员"})]}),o.jsxs("select",{className:"px-3 py-2 border border-border-primary rounded-lg text-sm bg-bg-primary",...u.register("dateRange"),children:[o.jsx("option",{value:"all",children:"全部时间"}),o.jsx("option",{value:"24h",children:"最近24小时"}),o.jsx("option",{value:"7d",children:"最近7天"}),o.jsx("option",{value:"30d",children:"最近30天"})]})]}),t.length>0&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsxs("span",{className:"text-sm text-text-secondary",children:["已选择 ",t.length," 个用户"]}),o.jsx("button",{onClick:()=>_("activate"),className:"px-3 py-1 text-sm bg-status-success text-white rounded hover:opacity-80",children:"激活"}),o.jsx("button",{onClick:()=>_("deactivate"),className:"px-3 py-1 text-sm bg-status-warning text-white rounded hover:opacity-80",children:"停用"}),o.jsx("button",{onClick:()=>_("upgrade"),className:"px-3 py-1 text-sm bg-accent-primary text-white rounded hover:bg-accent-hover",children:"升级"})]})]})}),o.jsx("div",{className:"px-6 py-6",children:o.jsxs("div",{className:"bg-bg-primary border border-border-primary rounded-lg overflow-hidden shadow-card",children:[o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"w-full",children:[o.jsx("thead",{className:"bg-bg-secondary border-b border-border-secondary",children:o.jsxs("tr",{children:[o.jsx("th",{className:"px-4 py-3 text-left",children:o.jsx("input",{type:"checkbox",checked:t.length===b.length&&b.length>0,onChange:p=>{p.target.checked?r(b.map(k=>k.id)):r([])},className:"rounded border-border-primary text-accent-primary focus:ring-accent-primary"})}),o.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-text-secondary cursor-pointer hover:text-text-primary",onClick:()=>T("nickname"),children:"用户信息"}),o.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-text-secondary cursor-pointer hover:text-text-primary",onClick:()=>T("membershipLevel"),children:"会员等级"}),o.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-text-secondary cursor-pointer hover:text-text-primary",onClick:()=>T("totalSpent"),children:"消费数据"}),o.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-text-secondary cursor-pointer hover:text-text-primary",onClick:()=>T("lastSeenAt"),children:"活跃状态"}),o.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-text-secondary",children:"操作"})]})}),o.jsx("tbody",{className:"divide-y divide-border-secondary",children:b.map(p=>o.jsxs("tr",{className:"hover:bg-bg-hover transition-colors",children:[o.jsx("td",{className:"px-4 py-4",children:o.jsx("input",{type:"checkbox",checked:t.includes(p.id),onChange:k=>{k.target.checked?r([...t,p.id]):r(t.filter(O=>O!==p.id))},className:"rounded border-border-primary text-accent-primary focus:ring-accent-primary"})}),o.jsx("td",{className:"px-4 py-4",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"w-10 h-10 bg-accent-light rounded-full flex items-center justify-center",children:p.avatar?o.jsx("img",{src:p.avatar,alt:p.nickname,className:"w-10 h-10 rounded-full"}):o.jsx(gt,{className:"w-5 h-5 text-accent-primary"})}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-text-primary",children:p.nickname}),o.jsxs("p",{className:"text-sm text-text-tertiary flex items-center",children:[o.jsx(Un,{className:"w-3 h-3 mr-1"}),p.phone]})]})]})}),o.jsx("td",{className:"px-4 py-4",children:o.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${v[p.membershipLevel].bgColor} ${v[p.membershipLevel].color}`,children:[p.membershipLevel==="lifetime"&&o.jsx(js,{className:"w-3 h-3 mr-1"}),v[p.membershipLevel].label]})}),o.jsx("td",{className:"px-4 py-4",children:o.jsxs("div",{className:"text-sm",children:[o.jsxs("p",{className:"font-medium text-text-primary",children:["¥",p.totalSpent.toLocaleString()]}),o.jsxs("p",{className:"text-text-tertiary",children:[p.starPointsBalance," 星点"]})]})}),o.jsx("td",{className:"px-4 py-4",children:o.jsxs("div",{className:"text-sm",children:[o.jsx("p",{className:"text-text-primary",children:ve(new Date(p.lastSeenAt),"MM/dd HH:mm")}),o.jsxs("p",{className:"text-text-tertiary flex items-center",children:[o.jsx(Ss,{className:"w-3 h-3 mr-1"}),"注册 ",ve(new Date(p.createdAt),"yyyy/MM/dd")]})]})}),o.jsx("td",{className:"px-4 py-4",children:o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("button",{onClick:()=>y(p.id,"edit"),className:"p-1 text-text-tertiary hover:text-accent-primary hover:bg-accent-background rounded transition-colors",title:"编辑用户",children:o.jsx(Ln,{className:"w-4 h-4"})}),o.jsx("button",{onClick:()=>y(p.id,"view_profile"),className:"p-1 text-text-tertiary hover:text-status-info hover:bg-blue-50 rounded transition-colors",title:"查看详情",children:o.jsx(vr,{className:"w-4 h-4"})}),o.jsx("button",{onClick:()=>y(p.id,"ban"),className:"p-1 text-text-tertiary hover:text-status-error hover:bg-red-50 rounded transition-colors",title:"封禁用户",children:o.jsx(Mn,{className:"w-4 h-4"})}),o.jsx("button",{className:"p-1 text-text-tertiary hover:text-text-primary hover:bg-bg-hover rounded transition-colors",children:o.jsx(br,{className:"w-4 h-4"})})]})})]},p.id))})]})}),w>l&&o.jsx("div",{className:"px-6 py-4 border-t border-border-secondary",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"text-sm text-text-tertiary",children:["显示 ",(a-1)*l+1," 到 ",Math.min(a*l,w)," 条，共 ",w," 条记录"]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("button",{onClick:()=>c(Math.max(1,a-1)),disabled:a===1,className:"px-3 py-1 border border-border-primary rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-bg-hover",children:"上一页"}),o.jsxs("span",{className:"text-sm text-text-secondary",children:[a," / ",Math.ceil(w/l)]}),o.jsx("button",{onClick:()=>c(Math.min(Math.ceil(w/l),a+1)),disabled:a===Math.ceil(w/l),className:"px-3 py-1 border border-border-primary rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-bg-hover",children:"下一页"})]})]})})]})})]})},wc=({feishuContext:s,className:e=""})=>{var N;const[t,r]=P.useState([]),[n,i]=P.useState("pending"),[a,c]=P.useState("all"),[l,u]=P.useState("all"),[d,h]=P.useState(1),f=20,m=P.useMemo(()=>({page:d,pageSize:f,status:n,priority:a!=="all"?a:void 0,contentType:l!=="all"?l:void 0}),[d,n,a,l]),{data:g,error:b,mutate:w}=Me(["content-moderation",m],()=>V.getComponentData("content_moderation",m)),{data:v}=Me("moderation-stats",()=>V.getComponentData("content_moderation",{type:"stats"})),T=(g==null?void 0:g.items)||[],y=(g==null?void 0:g.total)||0,_=v||{pending:0,approved:0,rejected:0,flagged:0},j={pending:{label:"待审核",color:"text-status-warning",bgColor:"bg-orange-50",icon:Dr},approved:{label:"已通过",color:"text-status-success",bgColor:"bg-accent-light",icon:ot},rejected:{label:"已拒绝",color:"text-status-error",bgColor:"bg-red-50",icon:lt},flagged:{label:"已标记",color:"text-status-info",bgColor:"bg-blue-50",icon:$t}},p={low:{label:"低",color:"text-text-tertiary",bgColor:"bg-bg-tertiary"},medium:{label:"中",color:"text-status-info",bgColor:"bg-blue-50"},high:{label:"高",color:"text-status-warning",bgColor:"bg-orange-50"},urgent:{label:"紧急",color:"text-status-error",bgColor:"bg-red-50"}},k={text:Fn,image:Mr,audio:Lr,video:Ur},O=async(x,S,R)=>{try{await V.getComponentData("content_moderation",{action:S,itemId:x,reviewerId:s==null?void 0:s.userId,reason:R}),w(),await V.logComponentUsage("content_moderation",S,{itemId:x,reviewer:s==null?void 0:s.userId,reason:R})}catch(re){console.error(`Failed to ${S} content:`,re)}},B=async x=>{if(t.length!==0)try{await V.getComponentData("content_moderation",{action:`batch_${x}`,itemIds:t,reviewerId:s==null?void 0:s.userId}),w(),r([]),await V.logComponentUsage("content_moderation",`batch_${x}`,{itemCount:t.length,reviewer:s==null?void 0:s.userId})}catch(S){console.error(`Failed to batch ${x}:`,S)}},L=x=>{const S=k[x.contentType];switch(x.contentType){case"text":return o.jsx("div",{className:"text-sm text-text-secondary line-clamp-3",children:x.content});case"image":return o.jsx("div",{className:"w-16 h-16 bg-bg-tertiary rounded-lg flex items-center justify-center",children:o.jsx(Mr,{className:"w-6 h-6 text-text-tertiary"})});case"audio":return o.jsx("div",{className:"w-16 h-16 bg-bg-tertiary rounded-lg flex items-center justify-center",children:o.jsx(Lr,{className:"w-6 h-6 text-text-tertiary"})});case"video":return o.jsx("div",{className:"w-16 h-16 bg-bg-tertiary rounded-lg flex items-center justify-center",children:o.jsx(Ur,{className:"w-6 h-6 text-text-tertiary"})});default:return o.jsx("div",{className:"w-16 h-16 bg-bg-tertiary rounded-lg flex items-center justify-center",children:o.jsx(S,{className:"w-6 h-6 text-text-tertiary"})})}};return o.jsxs("div",{className:`min-h-screen bg-bg-secondary ${e}`,children:[o.jsx("div",{className:"bg-bg-primary border-b border-border-primary px-6 py-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsxs("h1",{className:"text-2xl font-bold text-text-primary flex items-center",children:[o.jsx(vr,{className:"w-6 h-6 mr-2 text-accent-primary"}),"内容审核中心"]}),o.jsxs("p",{className:"text-sm text-text-tertiary mt-1",children:["管理和审核用户生成内容 • 总计 ",y.toLocaleString()," 条内容"]})]}),t.length>0&&o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsxs("span",{className:"text-sm text-text-secondary",children:["已选择 ",t.length," 条内容"]}),o.jsxs("button",{onClick:()=>B("approve"),className:"flex items-center px-3 py-2 bg-status-success text-white rounded-lg hover:opacity-80 transition-opacity text-sm",children:[o.jsx(ot,{className:"w-4 h-4 mr-1"}),"批量通过"]}),o.jsxs("button",{onClick:()=>B("reject"),className:"flex items-center px-3 py-2 bg-status-error text-white rounded-lg hover:opacity-80 transition-opacity text-sm",children:[o.jsx(lt,{className:"w-4 h-4 mr-1"}),"批量拒绝"]})]})]})}),o.jsxs("div",{className:"px-6 py-6",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[o.jsx("div",{className:`bg-bg-primary border rounded-lg p-6 cursor-pointer transition-all ${n==="pending"?"border-status-warning shadow-hover":"border-border-primary hover:border-border-focus"}`,onClick:()=>i("pending"),children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-2xl font-bold text-status-warning",children:_.pending}),o.jsx("p",{className:"text-sm text-text-secondary",children:"待审核"})]}),o.jsx(Dr,{className:"w-8 h-8 text-status-warning opacity-50"})]})}),o.jsx("div",{className:`bg-bg-primary border rounded-lg p-6 cursor-pointer transition-all ${n==="approved"?"border-status-success shadow-hover":"border-border-primary hover:border-border-focus"}`,onClick:()=>i("approved"),children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-2xl font-bold text-status-success",children:_.approved}),o.jsx("p",{className:"text-sm text-text-secondary",children:"已通过"})]}),o.jsx(ot,{className:"w-8 h-8 text-status-success opacity-50"})]})}),o.jsx("div",{className:`bg-bg-primary border rounded-lg p-6 cursor-pointer transition-all ${n==="rejected"?"border-status-error shadow-hover":"border-border-primary hover:border-border-focus"}`,onClick:()=>i("rejected"),children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-2xl font-bold text-status-error",children:_.rejected}),o.jsx("p",{className:"text-sm text-text-secondary",children:"已拒绝"})]}),o.jsx(lt,{className:"w-8 h-8 text-status-error opacity-50"})]})}),o.jsx("div",{className:`bg-bg-primary border rounded-lg p-6 cursor-pointer transition-all ${n==="flagged"?"border-status-info shadow-hover":"border-border-primary hover:border-border-focus"}`,onClick:()=>i("flagged"),children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-2xl font-bold text-status-info",children:_.flagged}),o.jsx("p",{className:"text-sm text-text-secondary",children:"已标记"})]}),o.jsx($t,{className:"w-8 h-8 text-status-info opacity-50"})]})})]}),o.jsx("div",{className:"bg-bg-primary border border-border-primary rounded-lg p-4 mb-6",children:o.jsxs("div",{className:"flex items-center justify-between space-x-4",children:[o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(Es,{className:"w-4 h-4 text-text-tertiary"}),o.jsxs("select",{value:a,onChange:x=>c(x.target.value),className:"px-3 py-2 border border-border-primary rounded-lg text-sm bg-bg-primary",children:[o.jsx("option",{value:"all",children:"全部优先级"}),o.jsx("option",{value:"urgent",children:"紧急"}),o.jsx("option",{value:"high",children:"高"}),o.jsx("option",{value:"medium",children:"中"}),o.jsx("option",{value:"low",children:"低"})]})]}),o.jsxs("select",{value:l,onChange:x=>u(x.target.value),className:"px-3 py-2 border border-border-primary rounded-lg text-sm bg-bg-primary",children:[o.jsx("option",{value:"all",children:"全部类型"}),o.jsx("option",{value:"text",children:"文本"}),o.jsx("option",{value:"image",children:"图片"}),o.jsx("option",{value:"audio",children:"音频"}),o.jsx("option",{value:"video",children:"视频"})]})]}),o.jsxs("div",{className:"text-sm text-text-tertiary",children:["当前筛选: ",(N=j[n])==null?void 0:N.label," • 共 ",y," 条"]})]})}),o.jsxs("div",{className:"bg-bg-primary border border-border-primary rounded-lg overflow-hidden shadow-card",children:[o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"w-full",children:[o.jsx("thead",{className:"bg-bg-secondary border-b border-border-secondary",children:o.jsxs("tr",{children:[o.jsx("th",{className:"px-4 py-3 text-left",children:o.jsx("input",{type:"checkbox",checked:t.length===T.length&&T.length>0,onChange:x=>{x.target.checked?r(T.map(S=>S.id)):r([])},className:"rounded border-border-primary text-accent-primary focus:ring-accent-primary"})}),o.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-text-secondary",children:"内容信息"}),o.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-text-secondary",children:"优先级"}),o.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-text-secondary",children:"AI评分"}),o.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-text-secondary",children:"状态"}),o.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-text-secondary",children:"创建时间"}),o.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-text-secondary",children:"操作"})]})}),o.jsx("tbody",{className:"divide-y divide-border-secondary",children:T.map(x=>o.jsxs("tr",{className:"hover:bg-bg-hover transition-colors",children:[o.jsx("td",{className:"px-4 py-4",children:o.jsx("input",{type:"checkbox",checked:t.includes(x.id),onChange:S=>{S.target.checked?r([...t,x.id]):r(t.filter(R=>R!==x.id))},className:"rounded border-border-primary text-accent-primary focus:ring-accent-primary"})}),o.jsx("td",{className:"px-4 py-4",children:o.jsxs("div",{className:"flex items-start space-x-3",children:[L(x),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[Fe.createElement(k[x.contentType],{className:"w-4 h-4 text-text-tertiary"}),o.jsxs("span",{className:"text-sm font-medium text-text-primary",children:[x.contentType.toUpperCase()," 内容"]})]}),o.jsxs("p",{className:"text-sm text-text-tertiary mt-1",children:["ID: ",x.contentId," • 作者: ",x.authorId]})]})]})}),o.jsx("td",{className:"px-4 py-4",children:o.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${p[x.priority].bgColor} ${p[x.priority].color}`,children:p[x.priority].label})}),o.jsx("td",{className:"px-4 py-4",children:o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-16 bg-bg-tertiary rounded-full h-2",children:o.jsx("div",{className:"h-2 rounded-full bg-accent-primary",style:{width:`${x.aiScore}%`}})}),o.jsxs("span",{className:"text-sm font-medium text-text-primary",children:[x.aiScore,"%"]})]})}),o.jsx("td",{className:"px-4 py-4",children:o.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${j[x.status].bgColor} ${j[x.status].color}`,children:[Fe.createElement(j[x.status].icon,{className:"w-3 h-3 mr-1"}),j[x.status].label]})}),o.jsx("td",{className:"px-4 py-4",children:o.jsxs("div",{className:"text-sm",children:[o.jsx("p",{className:"text-text-primary",children:ve(new Date(x.createdAt),"MM/dd HH:mm")}),x.reviewedAt&&o.jsxs("p",{className:"text-text-tertiary",children:["审核于 ",ve(new Date(x.reviewedAt),"MM/dd HH:mm")]})]})}),o.jsx("td",{className:"px-4 py-4",children:o.jsxs("div",{className:"flex items-center space-x-2",children:[x.status==="pending"&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:()=>O(x.id,"approve"),className:"p-1 text-text-tertiary hover:text-status-success hover:bg-green-50 rounded transition-colors",title:"通过审核",children:o.jsx(ot,{className:"w-4 h-4"})}),o.jsx("button",{onClick:()=>O(x.id,"reject"),className:"p-1 text-text-tertiary hover:text-status-error hover:bg-red-50 rounded transition-colors",title:"拒绝审核",children:o.jsx(lt,{className:"w-4 h-4"})}),o.jsx("button",{onClick:()=>O(x.id,"flag"),className:"p-1 text-text-tertiary hover:text-status-warning hover:bg-orange-50 rounded transition-colors",title:"标记内容",children:o.jsx($t,{className:"w-4 h-4"})})]}),o.jsx("button",{className:"p-1 text-text-tertiary hover:text-text-primary hover:bg-bg-hover rounded transition-colors",children:o.jsx(Bn,{className:"w-4 h-4"})}),o.jsx("button",{className:"p-1 text-text-tertiary hover:text-text-primary hover:bg-bg-hover rounded transition-colors",children:o.jsx(br,{className:"w-4 h-4"})})]})})]},x.id))})]})}),y>f&&o.jsx("div",{className:"px-6 py-4 border-t border-border-secondary",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"text-sm text-text-tertiary",children:["显示 ",(d-1)*f+1," 到 ",Math.min(d*f,y)," 条，共 ",y," 条记录"]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("button",{onClick:()=>h(Math.max(1,d-1)),disabled:d===1,className:"px-3 py-1 border border-border-primary rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-bg-hover",children:"上一页"}),o.jsxs("span",{className:"text-sm text-text-secondary",children:[d," / ",Math.ceil(y/f)]}),o.jsx("button",{onClick:()=>h(Math.min(Math.ceil(y/f),d+1)),disabled:d===Math.ceil(y/f),className:"px-3 py-1 border border-border-primary rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-bg-hover",children:"下一页"})]})]})})]})]})]})};function xc(){const[s,e]=P.useState(!1),[t,r]=P.useState();return P.useEffect(()=>{const n=new URLSearchParams(window.location.search),i=n.get("feishu_user_id");i&&r({userId:i,userName:n.get("feishu_user_name")||"未知用户",tableId:n.get("feishu_table_id")||"",permissions:(n.get("permissions")||"").split(",").filter(Boolean),locale:n.get("locale")||"zh-CN",theme:n.get("theme")||"light"})},[]),P.useEffect(()=>{const n=i=>{if(!["https://feishu.cn","https://larksuite.com","https://bytedance.feishu.cn"].some(u=>i.origin.includes(u)))return;const{type:c,data:l}=i.data;switch(c){case"feishu_resize":document.documentElement.style.height=`${l.height}px`;break;case"feishu_theme_change":document.documentElement.setAttribute("data-theme",l.theme);break;case"feishu_refresh":window.location.reload();break}};return window.addEventListener("message",n),window.parent.postMessage({type:"component_ready",componentType:"admin_system",data:{height:document.body.scrollHeight,title:"星趣App后台管理系统"}},"*"),()=>window.removeEventListener("message",n)},[]),o.jsx(jn,{children:o.jsxs("div",{className:"flex h-screen bg-bg-secondary",children:[o.jsx(ii,{collapsed:s,onToggle:e,feishuContext:t}),o.jsx("main",{className:`flex-1 overflow-hidden transition-all duration-300 ${s?"ml-16":"ml-64"}`,children:o.jsxs(kn,{children:[o.jsx(at,{path:"/",element:o.jsx(Sn,{to:"/dashboard",replace:!0})}),o.jsx(at,{path:"/dashboard",element:o.jsx(gc,{feishuContext:t,autoRefresh:!0,refreshInterval:3e4})}),o.jsx(at,{path:"/users",element:o.jsx(bc,{feishuContext:t})}),o.jsx(at,{path:"/moderation",element:o.jsx(wc,{feishuContext:t})})]})})]})})}document.title="星趣App - 后台管理系统";const _c=new URLSearchParams(window.location.search),jc=_c.get("theme")||"light";document.documentElement.setAttribute("data-theme",jc);const kc=Xt.createRoot(document.getElementById("root"));kc.render(o.jsx(Fe.StrictMode,{children:o.jsx(xc,{})}));window.addEventListener("error",s=>{var e,t;console.error("Admin system error:",s.error),window.parent.postMessage({type:"component_error",componentType:"admin_system",error:{message:(e=s.error)==null?void 0:e.message,stack:(t=s.error)==null?void 0:t.stack}},"*")});window.addEventListener("load",()=>{const s=performance.now();console.log(`Admin system loaded in ${s.toFixed(2)}ms`),window.parent.postMessage({type:"component_performance",componentType:"admin_system",metrics:{loadTime:s,timestamp:new Date().toISOString()}},"*")});
//# sourceMappingURL=index-vn4ofkar.js.map
