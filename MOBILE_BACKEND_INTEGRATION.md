# ğŸ“± ç§»åŠ¨ç«¯ä¸åå°ç³»ç»Ÿé›†æˆæŒ‡å—

## ğŸ¯ é›†æˆæ¦‚è¿°

æ˜Ÿè¶£Appç§»åŠ¨ç«¯ï¼ˆFlutterï¼‰ä¸Webåå°ç®¡ç†ç³»ç»Ÿç°å·²å®ç°å®Œæ•´çš„å®æ—¶æ•°æ®åŒæ­¥ï¼Œç¡®ä¿iOSæ¨¡æ‹Ÿå™¨ä¸Šçš„ç”¨æˆ·æ“ä½œèƒ½å¤Ÿå®æ—¶åæ˜ åœ¨åå°ç®¡ç†ç³»ç»Ÿä¸­ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•°æ®æµå‘å›¾
```
iOSæ¨¡æ‹Ÿå™¨ (Flutter App) 
    â†“ ç”¨æˆ·æ“ä½œ
Analytics Service (ç§»åŠ¨ç«¯)
    â†“ æ•°æ®ä¸ŠæŠ¥
Supabase Real-time Database
    â†“ å®æ—¶åŒæ­¥
Webåå°ç®¡ç†ç³»ç»Ÿ (React)
    â†“ æ•°æ®å±•ç¤º
ç§»åŠ¨ç«¯ç›‘æ§é¡µé¢
```

### æ ¸å¿ƒç»„ä»¶

1. **ç§»åŠ¨ç«¯åˆ†ææœåŠ¡** (`analytics_service.dart`)
   - è‡ªåŠ¨æ”¶é›†ç”¨æˆ·è¡Œä¸ºæ•°æ®
   - è®¾å¤‡ä¿¡æ¯æ”¶é›†
   - å®æ—¶æ•°æ®ä¸ŠæŠ¥åˆ°Supabase
   - æ”¯æŒç¦»çº¿æ•°æ®ç¼“å­˜

2. **Webç«¯åŒæ­¥æœåŠ¡** (`mobile-sync.ts`)
   - ç›‘å¬Supabaseå®æ—¶å˜æ›´
   - å¤„ç†å„ç§ç±»å‹çš„ç§»åŠ¨ç«¯äº‹ä»¶
   - æ•°æ®è½¬æ¢å’Œå›è°ƒç®¡ç†

3. **ç§»åŠ¨ç«¯ç›‘æ§ç»„ä»¶** (`MobileDataMonitor.tsx`)
   - å®æ—¶æ˜¾ç¤ºç§»åŠ¨ç«¯æ•°æ®
   - ç”¨æˆ·æ´»åŠ¨ç»Ÿè®¡
   - äº¤äº’è¡Œä¸ºåˆ†æ

## ğŸ“Š ç›‘æ§çš„æ•°æ®ç±»å‹

### 1. ç”¨æˆ·æ´»åŠ¨æ•°æ®
- **é¡µé¢è®¿é—®**: è®°å½•ç”¨æˆ·æµè§ˆçš„é¡µé¢å’Œåœç•™æ—¶é—´
- **åº”ç”¨å¯åŠ¨/å…³é—­**: ä¼šè¯ç®¡ç†å’Œç”¨æˆ·æ´»è·ƒåº¦
- **åŠŸèƒ½ä½¿ç”¨**: æŒ‰é’®ç‚¹å‡»ã€èœå•æ“ä½œç­‰äº¤äº’è¡Œä¸º

### 2. AIè§’è‰²äº¤äº’
- **å¯¹è¯ä¼šè¯**: èŠå¤©å¼€å§‹ã€æ¶ˆæ¯å‘é€ã€ä¼šè¯æ—¶é•¿
- **è§’è‰²å…³æ³¨**: å…³æ³¨ã€å–æ¶ˆå…³æ³¨æ“ä½œ
- **è§’è‰²åˆ›å»º**: ç”¨æˆ·åˆ›å»ºçš„AIè§’è‰²ä¿¡æ¯

### 3. å†…å®¹æ¶ˆè´¹è¡Œä¸º
- **éŸ³é¢‘æ’­æ”¾**: æ’­æ”¾æ—¶é•¿ã€å®Œæˆç‡ã€æš‚åœ/è·³è¿‡è¡Œä¸º
- **å†…å®¹æµè§ˆ**: æŸ¥çœ‹çš„å†…å®¹ç±»å‹å’Œåœç•™æ—¶é—´
- **æœç´¢è¡Œä¸º**: æœç´¢å…³é”®è¯å’Œç»“æœç‚¹å‡»

### 4. ç¤¾äº¤äº’åŠ¨
- **ç‚¹èµ/æ”¶è—**: å¯¹å†…å®¹çš„äº’åŠ¨åé¦ˆ
- **è¯„è®º**: ç”¨æˆ·è¯„è®ºè¡Œä¸ºå’Œå†…å®¹
- **åˆ†äº«**: å†…å®¹åˆ†äº«åˆ°å¤–éƒ¨å¹³å°

### 5. åˆ›ä½œæ´»åŠ¨
- **å†…å®¹åˆ›å»º**: åˆ›ä½œçš„å†…å®¹ç±»å‹ã€å‘å¸ƒçŠ¶æ€
- **æ¨¡æ¿ä½¿ç”¨**: ä½¿ç”¨çš„æ¨¡æ¿å’Œå®šåˆ¶åŒ–ç¨‹åº¦
- **åˆ›ä½œè¿›åº¦**: ä¿å­˜è‰ç¨¿ã€ç¼–è¾‘æ¬¡æ•°

### 6. ä¼šå‘˜è®¢é˜…
- **è®¢é˜…è´­ä¹°**: è®¢é˜…è®¡åˆ’é€‰æ‹©ã€æ”¯ä»˜æ–¹å¼
- **ä¼šå‘˜æƒç›Šä½¿ç”¨**: VIPåŠŸèƒ½çš„ä½¿ç”¨é¢‘ç‡
- **ç»­è´¹è¡Œä¸º**: è‡ªåŠ¨ç»­è´¹ã€æ‰‹åŠ¨ç»­è´¹æƒ…å†µ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨Webåå°ç®¡ç†ç³»ç»Ÿ

```bash
# è¿›å…¥åå°ç³»ç»Ÿç›®å½•
cd /Volumes/wawa_outer_4T/Users/wawa002/Documents/XingQu/web-components

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# è®¿é—®ç§»åŠ¨ç«¯ç›‘æ§é¡µé¢
# http://localhost:3000/mobile
```

### 2. é…ç½®Flutterç§»åŠ¨åº”ç”¨

```bash
# è¿›å…¥Flutteré¡¹ç›®ç›®å½•
cd /Volumes/wawa_outer_4T/Users/wawa002/Documents/XingQu

# å®‰è£…æ–°ä¾èµ–
flutter pub get

# å¯åŠ¨iOSæ¨¡æ‹Ÿå™¨
open -a Simulator

# è¿è¡ŒFlutteråº”ç”¨
flutter run
```

### 3. è®¿é—®åˆ†ææµ‹è¯•é¡µé¢

åœ¨Flutteråº”ç”¨ä¸­å¯¼èˆªåˆ°åˆ†ææµ‹è¯•é¡µé¢ï¼š
- æ–¹æ³•1: åœ¨åº”ç”¨ä¸­ç›´æ¥è·¯ç”±è·³è½¬ `/analytics_test`
- æ–¹æ³•2: åœ¨è®¾ç½®é¡µé¢æ·»åŠ æµ‹è¯•å…¥å£ï¼ˆæ¨èï¼‰

## ğŸ§ª æµ‹è¯•éªŒè¯æ­¥éª¤

### æ­¥éª¤1: å¯åŠ¨ç›‘æ§ç³»ç»Ÿ
1. ç¡®ä¿Webåå°ç®¡ç†ç³»ç»Ÿæ­£åœ¨è¿è¡Œ
2. æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:3000/mobile`
3. éªŒè¯è¿æ¥çŠ¶æ€æ˜¾ç¤ºä¸º"å·²è¿æ¥"

### æ­¥éª¤2: è¿è¡ŒFlutteråº”ç”¨
1. å¯åŠ¨iOSæ¨¡æ‹Ÿå™¨
2. è¿è¡Œ `flutter run` å¯åŠ¨åº”ç”¨
3. ç¡®ä¿åº”ç”¨æˆåŠŸè¿æ¥åˆ°Supabase

### æ­¥éª¤3: æ‰§è¡Œæµ‹è¯•æ“ä½œ
1. åœ¨Flutteråº”ç”¨ä¸­è¿›å…¥åˆ†ææµ‹è¯•é¡µé¢
2. ç‚¹å‡»å„ç§æµ‹è¯•æŒ‰é’®å‘é€æµ‹è¯•æ•°æ®
3. è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ç”Ÿæˆæ‰¹é‡æ•°æ®

### æ­¥éª¤4: éªŒè¯æ•°æ®åŒæ­¥
1. åœ¨Webåå°æŸ¥çœ‹ç§»åŠ¨ç«¯ç›‘æ§é¡µé¢
2. ç¡®è®¤æµ‹è¯•æ•°æ®å®æ—¶æ˜¾ç¤º
3. éªŒè¯ç»Ÿè®¡æ•°æ®æ­£ç¡®æ›´æ–°

## ğŸ“ˆ ç›‘æ§æ•°æ®è¯´æ˜

### å®æ—¶ç»Ÿè®¡æŒ‡æ ‡
- **ä»Šæ—¥æ´»è·ƒç”¨æˆ·**: å½“æ—¥æœ‰æ´»åŠ¨è®°å½•çš„ç”¨æˆ·æ•°é‡
- **ä»Šæ—¥äº’åŠ¨æ¬¡æ•°**: å„ç§ç”¨æˆ·äº¤äº’è¡Œä¸ºçš„æ€»è®¡æ•°
- **å½“å‰åœ¨çº¿ç”¨æˆ·**: æœ€è¿‘5åˆ†é’Ÿå†…æœ‰æ´»åŠ¨çš„ç”¨æˆ·

### äº¤äº’ç±»å‹ç»Ÿè®¡
- **ç‚¹èµæ•°**: ç”¨æˆ·ç‚¹èµæ“ä½œç»Ÿè®¡
- **è¯„è®ºæ•°**: ç”¨æˆ·è¯„è®ºæ“ä½œç»Ÿè®¡  
- **å…³æ³¨æ•°**: ç”¨æˆ·å…³æ³¨æ“ä½œç»Ÿè®¡
- **æ’­æ”¾æ•°**: éŸ³é¢‘/è§†é¢‘æ’­æ”¾æ“ä½œç»Ÿè®¡

### å®æ—¶æ´»åŠ¨æµ
æ˜¾ç¤ºæœ€æ–°çš„10æ¡ç”¨æˆ·æ´»åŠ¨è®°å½•ï¼ŒåŒ…æ‹¬ï¼š
- æ´»åŠ¨ç±»å‹å’Œæè¿°
- å‘ç”Ÿæ—¶é—´
- ç›¸å…³æ•°æ®è¯¦æƒ…

## ğŸ”§ å¼€å‘è€…å·¥å…·

### åˆ†æäº‹ä»¶API
```dart
// ç®€åŒ–çš„äº‹ä»¶è·Ÿè¸ªAPI
import '../services/analytics_service.dart';

// é¡µé¢è®¿é—®
Analytics.page('home_page');

// ç”¨æˆ·è¡Œä¸º
Analytics.event('button_click', {'button': 'play'});

// AIè§’è‰²äº¤äº’
Analytics.character('char_001', 'chat_start');

// éŸ³é¢‘æ’­æ”¾
Analytics.audio('audio_123', 180, 45, false);

// ç¤¾äº¤äº’åŠ¨  
Analytics.social('like', 'character', 'char_001');

// é”™è¯¯è·Ÿè¸ª
Analytics.error('network', 'Connection timeout');
```

### æ‰¹é‡æ•°æ®å¤„ç†
```dart
// æ‰¹é‡ä¸ŠæŠ¥äº‹ä»¶ï¼ˆç”¨äºç¦»çº¿æ•°æ®åŒæ­¥ï¼‰
final events = [
  {'event_type': 'page_view', 'page': 'home'},
  {'event_type': 'button_click', 'action': 'play'},
];

await AnalyticsService.instance.batchTrackEvents(events);
```

### Webç«¯ç›‘å¬å›è°ƒ
```typescript
// ç›‘å¬ç‰¹å®šç±»å‹çš„ç§»åŠ¨ç«¯äº‹ä»¶
mobileSyncService.onSync('user_activity', (data) => {
  console.log('User activity detected:', data);
  // æ›´æ–°UIæˆ–è§¦å‘å…¶ä»–ä¸šåŠ¡é€»è¾‘
});
```

## ğŸ“Š æ•°æ®å­˜å‚¨ç»“æ„

### Supabaseè¡¨ç»“æ„
```sql
-- ç”¨æˆ·åˆ†æäº‹ä»¶è¡¨
CREATE TABLE user_analytics (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    user_id UUID REFERENCES users(id),
    event_type TEXT NOT NULL,
    event_data JSONB,
    session_id TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ç»„ä»¶ä½¿ç”¨æ—¥å¿—è¡¨
CREATE TABLE component_usage_logs (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    component_name TEXT NOT NULL,
    event_type TEXT NOT NULL,
    event_data JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### äº‹ä»¶æ•°æ®æ ¼å¼
```json
{
  "user_id": "user_123",
  "event_type": "character_interaction",
  "event_data": {
    "character_id": "char_001",
    "interaction_type": "chat_start",
    "session_duration": 120,
    "message_count": 5
  },
  "session_id": "session_456",
  "device_info": {
    "platform": "ios",
    "device_model": "iPhone",
    "os_version": "17.0",
    "app_version": "1.0.0"
  },
  "timestamp": "2025-08-06T10:30:00Z"
}
```

## ğŸ”’ éšç§å’Œå®‰å…¨

### æ•°æ®è„±æ•
- ç”¨æˆ·æ•æ„Ÿä¿¡æ¯å·²åŠ å¯†æˆ–è„±æ•å¤„ç†
- è®¾å¤‡æ ‡è¯†ç¬¦ä½¿ç”¨UUIDæ›¿ä»£çœŸå®ID
- ä¸æ”¶é›†ç”¨æˆ·çœŸå®å§“åã€ç”µè¯ç­‰ä¸ªäººä¿¡æ¯

### æƒé™æ§åˆ¶
- åŸºäºRow Level Security (RLS) çš„æ•°æ®è®¿é—®æ§åˆ¶
- ä¸åŒè§’è‰²ç”¨æˆ·çœ‹åˆ°ä¸åŒèŒƒå›´çš„æ•°æ®
- APIè®¿é—®éœ€è¦æœ‰æ•ˆçš„è®¤è¯Token

### æ•°æ®ä¿ç•™
- ç”¨æˆ·æ´»åŠ¨æ•°æ®ä¿ç•™90å¤©
- ç»Ÿè®¡æ±‡æ€»æ•°æ®ä¿ç•™1å¹´
- ç”¨æˆ·å¯ä»¥ç”³è¯·åˆ é™¤ä¸ªäººæ•°æ®

## ğŸš¨ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **ç§»åŠ¨ç«¯æ•°æ®ä¸æ˜¾ç¤º**
   - æ£€æŸ¥Supabaseè¿æ¥é…ç½®
   - ç¡®è®¤ç”¨æˆ·å·²æ­£ç¡®ç™»å½•
   - éªŒè¯åˆ†ææœåŠ¡åˆå§‹åŒ–æˆåŠŸ

2. **Webç«¯æ— æ³•æ¥æ”¶æ•°æ®**
   - æ£€æŸ¥Webåº”ç”¨çš„Supabaseé…ç½®
   - éªŒè¯å®æ—¶è®¢é˜…æ˜¯å¦æ­£å¸¸å·¥ä½œ
   - ç¡®è®¤é˜²ç«å¢™æ²¡æœ‰é˜»æ­¢WebSocketè¿æ¥

3. **æ•°æ®å»¶è¿Ÿè¿‡é«˜**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥è´¨é‡
   - ä¼˜åŒ–SupabaseæŸ¥è¯¢æ€§èƒ½
   - è€ƒè™‘å¢åŠ æœ¬åœ°ç¼“å­˜æœºåˆ¶

### è°ƒè¯•å·¥å…·

1. **ç§»åŠ¨ç«¯è°ƒè¯•**
```dart
// å¯ç”¨è¯¦ç»†æ—¥å¿—
AnalyticsService.instance.setEnabled(true);

// æŸ¥çœ‹è®¾å¤‡ä¿¡æ¯
print('Device Info: ${AnalyticsService.instance._deviceInfo}');
```

2. **Webç«¯è°ƒè¯•**
```typescript
// æŸ¥çœ‹å®æ—¶è¿æ¥çŠ¶æ€
console.log('Sync service status:', mobileSyncService.isConnected);

// ç›‘å¬æ‰€æœ‰äº‹ä»¶
mobileSyncService.onSync('*', (data) => {
  console.log('All events:', data);
});
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### æ–‡æ¡£å‚è€ƒ
- [Supabaseå®æ—¶åŠŸèƒ½æ–‡æ¡£](https://supabase.com/docs/guides/realtime)
- [Flutteråˆ†ææœ€ä½³å®è·µ](https://flutter.dev/docs/cookbook/plugins/analytics)
- [Reactå®æ—¶æ•°æ®å¤„ç†](https://react.dev/learn/synchronizing-with-effects)

### è”ç³»æ–¹å¼
- é¡¹ç›®ä»“åº“: GitHub Issues
- æŠ€æœ¯æ–‡æ¡£: é¡¹ç›®README.md
- å¼€å‘å›¢é˜Ÿ: é¡¹ç›®ç»´æŠ¤è€…

---

**ç§»åŠ¨ç«¯ä¸åå°ç³»ç»Ÿé›†æˆ** - è®©æ•°æ®æµåŠ¨èµ·æ¥ï¼Œè®©åˆ†ææ›´ç²¾å‡† ğŸ“Šâœ¨